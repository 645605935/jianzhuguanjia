<include file="Public/header"/>
    <!-- basic styles -->
    <link href="__PUBLIC__/Admin/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome.min.css" />

    <!--[if IE 7]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome-ie7.min.css" />
    <![endif]-->

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.custom.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/chosen.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/bootstrap-timepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/daterangepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/colorpicker.css" />
    
    <!-- 模块jqgrid  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.full.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ui.jqgrid.css" />
    <!-- 模块jqgrid  end -->

    <!-- fonts -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/assets/css/google_font_css.css">

    <!-- ace styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-rtl.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-skins.min.css" />

    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/jquery-smartMenu/css/smartMenu.css" type="text/css" />
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->

    <link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">
    <link rel="stylesheet" href="__PUBLIC__/Admin/css/my_diy_css.css"  media="all">

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-ie.min.css" />
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->

    <script src="__PUBLIC__/Admin/assets/js/ace-extra.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.min.js"></script>
    <!-- layui.js   -->
    <script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>
    <script src="__PUBLIC__/layer/layer.js"></script>
<script>

  

</script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->



    <!--[if lt IE 9]>

    <script src="__PUBLIC__/Admin/assets/js/html5shiv.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/respond.min.js"></script>

    <![endif]-->

  </head>

  <body>
    <div class="navbar navbar-default" id="navbar">
      <include file="Public/navbar"/>
    </div>

    <div class="main-container" id="main-container">

      <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
      </script>

      <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
          <span class="menu-text"></span>
        </a>

        <!-- 左侧菜单栏 start-->
        <div class="sidebar" id="sidebar">
          <include file="Public/left"/>
        </div>
        
        <!-- 右侧主要内容 start-->
        <div class="main-content" style="overflow: hidden;">
          

          <!-- 右block_1  start -->
          <div class="breadcrumbs" id="breadcrumbs">
            <script type="text/javascript">
              try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
            </script>

            <ul class="breadcrumb">
              <include file="Public/_breadcrumb"/>
            </ul><!-- .breadcrumb -->

            <div class="nav-search" id="nav-search">
              <form class="form-search">
                <span class="input-icon">
                  <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                  <i class="icon-search nav-search-icon"></i>
                </span>
              </form>
            </div><!-- #nav-search -->
          </div>
          <!-- 右block_1  end -->

          <div class="page-content">

            <div class="row">
              <div class="col-xs-12">
                <style>
                  .layui-form-item{margin-bottom: 0px;}
                  #gbox_grid-table{width: 100%!important;}
                  #gview_grid-table{width: 100%!important;}
                  #gview_grid-table>div{width: 100%!important;}
                  #trv_Operation{display: none;}
                </style>

                <!-- 权限设置  start -->
                <div class="row">
                  <include file="Public/role_page_setting"/>
                </div>
                <!-- 权限设置  end -->

                <!-- 搜索  start -->
                <div class="row">
                    <form class="layui-form layui-form-pane col-xs-12" action="" method="post">

                        <table class="layui-table" id="search_table">
                          <thead>
                            <tr>
                              <th>搜索</th>
                            </tr> 
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">产线</label>
                                      <div class="layui-input-inline">
                                        <select name="Line" class="Line">
                                          <option value="请选择">全部</option>
                                          <option value="A" <if condition="$_POST['Line'] eq 'A'">selected</if>>A</option>
                                          <option value="B" <if condition="$_POST['Line'] eq 'B'">selected</if>>B</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>  

                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">状态</label>
                                      <div class="layui-input-inline">
                                        <select name="Status" class="Status">
                                          <option value="请选择">全部</option>
                                          <option value="未维护" <if condition="$_POST['Status'] eq '未维护'">selected</if>>未维护</option>
                                          <option value="未解决" <if condition="$_POST['Status'] eq '未解决'">selected</if>>未解决</option>
                                          <option value="已解决" <if condition="$_POST['Status'] eq '已解决'">selected</if>>已解决</option>
                                          <option value="已建工单" <if condition="$_POST['Status'] eq '已建工单'">selected</if>>已建工单</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div> 

                                  <div class="layui-inline" style="margin-top: 5px;">
                                    <div class="layui-form-item">
                                      <label class="layui-form-label">停线开始时间</label>
                                      <div class="layui-input-inline">
                                        <input class="layui-input Date1" name="Date1" value="{$_POST['Date1']}" placeholder="开始日" id="LAY_demorange_s">
                                      </div>
                                      <div class="layui-input-inline">
                                        <input class="layui-input Date2" name="Date2" value="{$_POST['Date2']}" placeholder="截止日" id="LAY_demorange_e">
                                      </div>
                                    </div>
                                  </div> 

                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                              <td>
                                <!-- <button style="float:left;" class="layui-btn" id="id-btn-dialog2_add"> 添加 </button> -->
                                <button style="float:left;" type="button" class="layui-btn export_list" id="export_list" title="export_list">导出</button>

                                <button style="float:right;" class="layui-btn" type="submit" title="搜索">搜索</button>
                              </td>
                            </tr> 
                          </tfoot>
                        </table>

                    </form>
                </div>
                <!-- 搜索  end -->

                <!-- PAGE CONTENT BEGINS -->
                <div class="row">
                      <div class="col-xs-7" id="home">
                          <!-- <table id="grid-table"></table>
                          <div id="grid-pager"></div> -->
                      </div>
                      <style type="text/css">
                        .right_box .header-color-blue2{background: none;color: black;}
                        .right_box .layui-form-label{width: auto!important;}
                      </style>
                      <div class="col-xs-5 right_box">
                             <div class="form_block" id="right_block" style="width: 100%;overflow: hidden;">
                               <form class="layui-form col-xs-12" action="">
                                 <!-- 设备详细信息 -->
                                 <div class="row">
                                   <div class="col-sm-12">
                                     <div class="widget-box">
                                       <div class="widget-header header-color-blue2">
                                         <h4 class="lighter smaller">停线信息</h4>
                                       </div>

                                       <div class="widget-body" style="padding:10px 10px!important;">

                                         <table class="table table-striped table-bordered table-hover">
                                            <tr>
                                              <td>
                                                <div class="layui-form-item">
                                                  <label class="layui-form-label">开始时间</label>
                                                  <div class="layui-input-inline">
                                                    <input type="text" id="BeginTime" disabled="" autocomplete="off" placeholder="" class="layui-input">
                                                  </div>
                                                </div>
                                              </td>
                                              <td>
                                                <div class="layui-form-item">
                                                  <label class="layui-form-label">结束时间</label>
                                                  <div class="layui-input-inline">
                                                    <input type="text" id="EndTime" disabled="" autocomplete="off" placeholder="" class="layui-input">
                                                  </div>
                                                </div>
                                              </td>
                                            </tr>
                                            <tr>
                                              <td>
                                                <div class="layui-form-item">
                                                  <label class="layui-form-label">持续时间</label>
                                                  <div class="layui-input-inline">
                                                    <input type="text" id="Duration" disabled="" autocomplete="off" placeholder="" class="layui-input">
                                                  </div>
                                                </div>
                                              </td>
                                              <td>
                                                <div class="layui-form-item">
                                                  <label class="layui-form-label">产线</label>
                                                  <div class="layui-input-inline">
                                                    <input type="text" id="Line" disabled="" autocomplete="off" placeholder="" class="layui-input">
                                                  </div>
                                                </div>
                                              </td>
                                            </tr>
                                            <tr>
                                              <td colspan="2">
                                                <div class="layui-form-item">
                                                  <label class="layui-form-label">班次</label>
                                                  <div class="layui-input-inline">
                                                    <input type="text" id="Banci" disabled="" autocomplete="off" placeholder="" class="layui-input">
                                                  </div>
                                                </div>
                                              </td>
                                            </tr>
                                            
                                          </table>
                                         
                                       </div>
                                     </div>
                                   </div>
                                 </div>

                                 <!-- 停线过程 -->
                                 <div class="row">
                                   <div class="col-sm-12">
                                     <div class="widget-box">
                                       <div class="widget-header header-color-blue2">
                                         <h4 class="lighter smaller">停线过程</h4>
                                       </div>

                                       <div class="widget-body" style="padding:10px 50px!important;">


                                          <div class="row">
                                              <div class="col-sm-6">
                                                  <div class="layui-form-item">
                                                    <label class="layui-form-label">停线原因</label>
                                                    <div class="layui-input-inline">
                                                      <select name="Type2" lay-filter="select_2" id="select_2">
                                                          <option value=""></option>
                                                      </select>
                                                    </div>

                                                    <div class="layui-input-inline" id="select_3_box" style="display: none;">
                                                      
                                                    </div>
                                                  </div>

                                                  <div class="layui-form-item">
                                                    <label class="layui-form-label">停线部位</label>
                                                    <div class="layui-input-inline">
                                                      <select name="Part" lay-filter="select_4" id="select_4">
                                                         <option value=""></option>
                                                      </select>
                                                    </div>
                                                  </div>

                                                  <div class="layui-form-item">
                                                    <label class="layui-form-label">停线类型</label>
                                                    <div class="layui-input-inline">
                                                      <select name="Describe" lay-filter="select_5" id="select_5">
                                                         <option value=""></option>
                                                      </select>
                                                    </div>
                                                  </div>

                                                  <div class="layui-form-item">
                                                    <label class="layui-form-label">是否已解决</label>
                                                    <div class="layui-input-inline" id="StatusID_box">
                                                      <input type="checkbox" id="StatusID" name="StatusID" title="选择">
                                                    </div>
                                                  </div>
                                              </div>
                                              <div class="col-sm-6">
                                                  <div class="layui-form-item">
                                                    <label class="layui-form-label">问题描述</label>
                                                    <div class="layui-input-inline" style="margin-left: 0px;">
                                                      <textarea style="height: 300px;" placeholder="请输入内容" name="Remarks" id="Remarks" class="layui-textarea"></textarea>
                                                    </div>
                                                  </div>
                                              </div>
                                          </div>

                                        </div>
                                     </div>
                                   </div>
                                 </div>

                                 <!-- 创建人联系方式 -->
                                 <div class="row">
                                   <div class="col-sm-12">
                                     <div class="widget-box">
                                       <div class="widget-header header-color-blue2">
                                         <h4 class="lighter smaller">操作</h4>
                                       </div>

                                       <div class="widget-body" style="padding:10px 50px!important;text-align:center;">
                                            <input type="hidden" id="stop_line_id" name="ID">
                                            <button class="layui-btn" lay-submit="" lay-filter="demo1_save" id="demo1_save" data-mould-id="">保存</button>
                                            <button class="layui-btn" lay-submit="" lay-filter="demo1_make_gongdan" id="make_gongdan" data-mould-id="" data-DieID="">生成工单</button>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               </form>
                             </div>
                      </div>

                </div>


                <!-- PAGE CONTENT ENDS -->
              </div><!-- /.col -->
              
            </div><!-- /.row -->
          </div><!-- /.page-content -->

        </div><!-- /.main-content -->
        <!-- 右侧主要内容 end-->

        
        
        <!-- 模板相关设置 -->
        <include file="Public/ace-settings-container"/>

      </div><!-- /.main-container-inner -->



      <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">

        <i class="icon-double-angle-up icon-only bigger-110"></i>

      </a>

    </div><!-- /.main-container -->

    <!-- 底栏版本说明 -->
    <include file="Public/footer"/>

    <!-- basic scripts -->

    <!--[if !IE]> -->



    <!-- <![endif]-->



    <!--[if IE]>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<![endif]-->



    <!--[if !IE]> -->



    <script type="text/javascript">

      window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");

    </script>



    <!-- <![endif]-->



    <!--[if IE]>

<script type="text/javascript">

 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");

</script>

<![endif]-->



    <script type="text/javascript">

      if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");

    </script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/typeahead-bs2.min.js"></script>



    <!-- page specific plugin scripts -->

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.custom.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/chosen.jquery.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/fuelux/fuelux.spinner.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-timepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/moment.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/daterangepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-colorpicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.knob.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.autosize.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.inputlimiter.1.3.1.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.maskedinput.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-tag.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.bootstrap.js"></script>
    
    <!-- 模块jqgrid  start -->
    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/jquery.jqGrid.min.js"></script>
    <!-- <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-en.js"></script> -->
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-zh.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.full.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>
    
    <!-- 模块jqgrid  end -->

    <!-- ace scripts -->



    <script src="__PUBLIC__/Admin/assets/js/ace-elements.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/ace.min.js"></script>

    

    <!-- inline scripts related to this page -->



    <script type="text/javascript">
      //数据列表初使化
      jQuery.support.cors=true;
 
      //获取列表
      function _ajax_list_device(_Line,_Status,_Date1,_Date2){
          var grid_data;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=40071&Line='+_Line+'&Status='+_Status+'&Date1='+_Date1+'&Date2='+_Date2,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      grid_data=json.data;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data;  
      } 

      
      //添加停线
      function _ajax_stop_line_add(start_time,end_time,Line){
          var grid_data;  
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4109&BeginTime='+start_time+'&EndTime='+end_time+'&Line='+Line,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      // window.location.reload();
                      grid_data=json.data;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data;  
      } 

      //保存停线
      function _ajax_stop_line_save(Type2,Part,Describe,Remarks,StatusID,ID,DeviceID){
          var _json;  
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4010&Type2='+Type2+'&Part='+Part+'&Describe='+Describe+'&Remarks='+Remarks+'&StatusID='+StatusID+'&ID='+ID,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      _json=json;
                      layer.msg(json.msg);
                  }else{
                      layer.msg(json.msg);
                      _json=json;
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return _json;  
      } 

      

      //获取问题类型1
      function _ajax_get_type_1(){
          var grid_data_type_1;  
          $.ajax({  
              async:false,
              type:'post',  
              url : 'http://'+api_url+'/Default.ashx?TaskID=4001',
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      grid_data_type_1=json.data;

                      var _select_1="";
                      _select_1+="<option value='请选择'>全部</option>";
                      $.each(grid_data_type_1, function(name, value) {
                           _select_1+="<option value='"+name+"'>"+value+"</option>";
                      });
                      $('#select_1').html(_select_1);
                      var form = layui.form();
                      form.render();
                  }else{
                      layer.msg(json.msg);
                  } 
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });   
          return grid_data_type_1;  
      } 

      //获取问题类型1_edit
      function _ajax_get_type_1_edit(text){
          var grid_data_type_1;  
          $.ajax({  
              async:false,
              type:'post',  
              url : 'http://'+api_url+'/Default.ashx?TaskID=4001',
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      grid_data_type_1=json.data;

                      var _select_1="";
                      _select_1+="<option value='请选择'>全部</option>";
                      $.each(grid_data_type_1, function(name, value) {
                           _select_1+="<option ";
                           if(text==value){
                              _select_1+="selected=''";
                           }
                           _select_1+=" value='"+name+"'>"+value+"</option>";
                      });
                      $('#select_1').html(_select_1);
                      var form = layui.form();
                      form.render();
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data_type_1;  
      }

      //获取问题类型2
      function _ajax_get_type_2(){
          var grid_data_type_2;  
          $.ajax({  
              async:false,
              type:'post',  
              url : 'http://'+api_url+'/Default.ashx?TaskID=4002',
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      grid_data_type_2=json.data;

                      var _select_2="";
                      _select_2+="<option value='请选择'>全部</option>";
                      $.each(grid_data_type_2, function(name, value) {
                           if(value=='生产'){
                              _select_2+="<option value='"+name+"' selected='selected'>"+value+"</option>";
                           }else{
                              _select_2+="<option value='"+name+"'>"+value+"</option>";
                           }
                      });
                      $('#select_2').html(_select_2);
                      var form = layui.form();
                      form.render();
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data_type_2;  
      } 

      //获取问题类型2_edit
      function _ajax_get_type_2_edit(text){
          var grid_data_type_1;
          $.ajax({  
              async:false,
              type:'post',  
              url : 'http://'+api_url+'/Default.ashx?TaskID=4002',
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      grid_data_type_2=json.data;

                      var _select_2="";
                      _select_2+="<option value='请选择'>全部</option>";
                      $.each(grid_data_type_2, function(name, value) {
                           _select_2+="<option ";
                           if(text==value){
                              _select_2+="selected=''";
                           }
                           _select_2+=" value='"+name+"'>"+value+"</option>";
                      });
                      $('#select_2').html(_select_2);
                      var form = layui.form();
                      form.render();
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data_type_1;  
      }

      //获取问题类型4_edit
      function _ajax_get_type_45_edit(text,type_4,type_5){
          //根据名称获取ID
          var Type2ID;
          $.each($('#select_2 option'), function(name, value) {
               if($(this).text()==text){
                Type2ID=$(this).val();
               }
          });

          var rowId = $(grid_selector).jqGrid('getGridParam','selrow');
          var rowData = $(grid_selector).jqGrid('getRowData',rowId);
          var Line=rowData.Line;

          
          var str_1 = "";
          var str_2 = "";
          var PartID;
          $.ajax({
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4003',
              dataType : 'json',
              data:{
                   Type2ID:Type2ID,
                   Line:Line
              },
              success: function(json) {
                 if (json.data != null) {
                    var jsonobj=json.data;
                    var length = jsonobj.length;
                    str_1+="<option value='请选择'>全部</option>";
                    for (var i = 0; i < length; i++) {   //循环option
                        if (i != length - 1) {
                            if(jsonobj[i].PartName == type_4){
                              str_1 += "<option ";
                              str_1 +="selected=''";
                              str_1 +=" value="+jsonobj[i].PartID+">" + jsonobj[i].PartName + "</option>";

                              PartID=jsonobj[i].PartID;
                            }else{
                              str_1 += "<option ";
                              str_1 +=" value="+jsonobj[i].PartID+">" + jsonobj[i].PartName + "</option>";
                            }
                        } else {
                            if(jsonobj[i].PartName == type_4){
                              str_1 += "<option ";
                              str_1 +="selected=''";
                              str_1 +=" value="+jsonobj[i].PartID+">" + jsonobj[i].PartName + "</option>";

                              PartID=jsonobj[i].PartID;
                            }else{
                              str_1 += "<option ";
                              str_1 +=" value="+jsonobj[i].PartID+">" + jsonobj[i].PartName + "</option>";
                            }
                        }
                    }
                  }
               }
          }); 



          // str_2="<option value='"+type_5+"'>"+type_5+"</option>";
          $.ajax({
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4004',
              dataType : 'json',
              data:{
                   PartID:PartID,
                   Line:Line
              },
              success: function(json) {
                 if (json.data != null) {
                    var jsonobj=json.data;
                    var length = jsonobj.length;
                    str_2+="<option value='请选择'>全部</option>";
                    for (var i = 0; i < length; i++) {   //循环option
                        if (i != length - 1) {
                            if(jsonobj[i].DescribeName == type_5){
                              str_2 += "<option ";
                              str_2 +="selected=''";
                              str_2 +=" value="+jsonobj[i].DescribeID+">" + jsonobj[i].DescribeName + "</option>";
                            }else{
                              str_2 += "<option ";
                              str_2 +=" value="+jsonobj[i].DescribeID+">" + jsonobj[i].DescribeName + "</option>";
                            }
                        } else {
                            if(jsonobj[i].DescribeName == type_5){
                              str_2 += "<option ";
                              str_2 +="selected=''";
                              str_2 +=" value="+jsonobj[i].DescribeID+">" + jsonobj[i].DescribeName + "</option>";
                            }else{
                              str_2 += "<option ";
                              str_2 +=" value="+jsonobj[i].DescribeID+">" + jsonobj[i].DescribeName + "</option>";
                            }
                        }
                    }
                  }
               }
          });
          

          $("#select_4").html(str_1);                    
          $("#select_5").html(str_2);
          var form = layui.form();
          form.render();
      }



       //生成工单
      function _ajax_add_gongdan(ProblemID, Creater, TypeID, OrderType, Type2ID, Flag){

          var _add_data ="{";
              _add_data+="'ProblemID':'"+ProblemID+"','Creater':'"+Creater+"',";
              _add_data+="'OrderType':'"+OrderType+"','Type2ID':'"+Type2ID+"','Flag':'"+Flag+"','TypeID':'"+TypeID+"'";
              _add_data+="}";

          var _json;
          $.ajax({  
              async:false,
              type:'post',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4015',
              data: _add_data,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code == 0){
                      _json=json;
                      layer.msg(json.msg);
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;  
      }


      //渲染select_3
      function render_select_3(DeviceID){
          var str_3 = "";
          $.ajax({
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=40145',
              dataType : 'json',
              success: function(json) {
                 if (json.data != null) {
                    var jsonobj=json.data;
                    var length = jsonobj.length;
                    str_3+="<option value='请选择'>全部</option>";
                    for (var i = 0; i < length; i++) {   //循环option
                        if (jsonobj[i].RowID == DeviceID && DeviceID>0) {
                            str_3 += "<option value="+jsonobj[i].RowID+" selected>" + jsonobj[i].D_Name + "</option>";
                        } else {
                            str_3 += "<option value="+jsonobj[i].RowID+">" + jsonobj[i].D_Name + "</option>";
                        }
                    }
                  }
               }
          });


          var _temp_='';


           _temp_='<select name="DeviceID" lay-filter="select_3" id="select_3">'
                    +str_3
                +'</select>';


          $("#select_3_box").hide().html(_temp_);
          layui.form().render();
      }


      //刷新停线列表
      function reload_grid_table(){

        var _sel_id_ = $(grid_selector).jqGrid('getGridParam', 'selrow');
        $('#home').html('<table id="grid-table"></table><div id="grid-pager"></div>');

        var _Line=$('#search_table .Line').val();
        var _Status=$('#search_table .Status').val();
        var _Date1=$('#search_table .Date1').val();
        var _Date2=$('#search_table .Date2').val();
        var grid_data=_ajax_list_device(_Line,_Status,_Date1,_Date2);




        jQuery(grid_selector).jqGrid({
          data: grid_data,
          datatype: "local",
          height: 430,
          caption: "停线列表",
          colNames:['ID', 'PartID', 'DieID', '模具名称', '模具编号', '产线', '班次', '开始时间', '结束时间', '持续时间（分）', '状态', '操作'],
          colModel:[
            {name:'ID',index:'ID', sorttype:"int",align : "center", hidden: true},
            {name:'PartID',index:'PartID', sorttype:"int",align : "center", hidden: true},
            {name:'DieID',index:'DieID', sorttype:"int",align : "center", hidden: true},

            {name:'DieName',index:'DieName',align:'center'},
            {name:'DieNumber',index:'DieNumber',align:'center'},
            {name:'Line',index:'Line',align:'center'},
            {name:'Banci',index:'Banci',align:'center'},
            {name:'BeginTime',index:'BeginTime', align : "center", width:250 },
            {name:'EndTime',index:'EndTime', align : "center", width:250},
            {name:'Duration',index:'Duration',align:'center'},
            {name:'Status',index:'Status',align:'center'},
            
            {name:'Operation',index:'Id',width:250, align:"center",sortable:false}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          viewrecords : true,
          rowNum:10,
          rowList:[10,20,30],
          pager : pager_selector,
          altRows: true,
          multiselect: true,
          multiboxonly: true,
      
          loadComplete : function() {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          },


          onSelectRow : function(ids) {
              var _rowData = $(grid_selector).jqGrid("getRowData", ids);

              if(_rowData.EndTime){
                  $("#demo1_save").removeAttr("disabled");
                  $("#make_gongdan").removeAttr("disabled");

                  var _problem_id=_rowData.ID;
                  $('#demo1_save').attr('data-mould-id',_problem_id);
                  $('#make_gongdan').attr('data-mould-id',_problem_id);
                  $('#make_gongdan').attr('data-DieID',_rowData.DieID);

                  $('#stop_line_id').val(_problem_id);
                  //获取列表
                  $.ajax({  
                      async:false,
                      type:'get',  
                      contentType:"application/x-www-form-urlencoded",
                      url : 'http://'+api_url+'/Default.ashx?TaskID=4017',
                      data: {ID:_problem_id},
                      dataType : 'json',
                      success  : function(json) {  
                        console.log(json);
                          if(json.code == 0){
                              data=json.data;



                              //停线原因为设备的时候，右侧出现下拉
                              if(data.Type2=="Device"){
                                  render_select_3(data.DeviceID);
                              }else{
                                  $('#select_3_box').hide().html('');
                              }

                              console.log(data);

                              // 停线信息
                              $('#right_block #BeginTime').val(data.BeginTime);
                              $('#right_block #EndTime').val(data.EndTime);
                              $('#right_block #Duration').val(data.Duration);
                              $('#right_block #Line').val(data.Line);
                              $('#right_block #Day').val(data.Day);
                              $('#right_block #Banci').val(data.Banci);

                              // 层级关系
                              var _Type2=data.Type2;
                              var _Part=data.Part;
                              var _Describe=data.Describe;
                              if($.trim(_Type2)!=''){
                                  _ajax_get_type_2_edit(_Type2);
                                  _ajax_get_type_45_edit(_Type2,_Part,_Describe);
                              }else{
                                  _ajax_get_type_2();
                                  $('#select_4').html("<option value='请选择'>全部</option>");
                                  $('#select_5').html("<option value='请选择'>全部</option>");
                              }

                              var _Status=data.Status;
                              if($.trim(_Status)=='已解决'){
                                  $('#StatusID_box').html('<input type="checkbox" id="StatusID" checked="checked" name="StatusID" title="选择">');
                              }else{
                                  $('#StatusID_box').html('<input type="checkbox" id="StatusID" name="StatusID" title="选择">');
                              }

                              $('#right_block #Remarks').val(data.Remarks);

                              var form = layui.form();
                              form.render();
                          }else{
                              alert(json.msg);
                          }
                      },
                      error  : function() {  
                          alert('error');
                      }  
                  }); 
              } else{
                  layer.msg('停线未结束不能维护');
                  $("#demo1_save").attr("disabled", true);
                  $("#make_gongdan").attr("disabled", true);
              }
          },
          

          gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
              var ids=jQuery(grid_selector).jqGrid('getDataIDs');
              for(var i=0; i<ids.length; i++){
                  var id=ids[i];  

                  var rowData = $(grid_selector).jqGrid('getRowData',id); 
                  console.log(rowData);
                  if(rowData.Status=="未维护"){
                      $('#grid-table tbody tr#'+id+" td[aria-describedby=grid-table_Status]").html("<span class='label label-danger arrowed arrowed-right'>未维护</span>");
                  }
                  if(rowData.Status=="未解决"){
                        $('#grid-table tbody tr#'+id+" td[aria-describedby=grid-table_Status]").html("<span class='label label-success arrowed arrowed-right'>未解决</span>");
                  }
                  if(rowData.Status=="已解决"){
                        $('#grid-table tbody tr#'+id+" td[aria-describedby=grid-table_Status]").html("<span class='label label-info arrowed arrowed-right'>已解决</span>");
                  }
                  if(rowData.Status=="已建工单"){
                        $('#grid-table tbody tr#'+id+" td[aria-describedby=grid-table_Status]").html("<span class='label label-warning arrowed arrowed-right'>已建工单</span>");
                  }
                  
                  operation= "<button style='margin-right:10px;' class='btn btn-danger btn-xs id-btn-dialog2_del' data-id='"+rowData.ID+"'><i class='icon-trash bigger-110'></i>删除</button>";  
                  
                  jQuery(grid_selector).jqGrid('setRowData', ids[i], { Operation: operation });
              }

              //设置选中行
              $(grid_selector).setSelection(_sel_id_);
          }
        });
      }


      //replace icons with FontAwesome icons like above   //更新分页图标  
      function updatePagerIcons(table) {
        var replacement = 
        {
          'ui-icon-seek-first' : 'icon-double-angle-left bigger-140',
          'ui-icon-seek-prev' : 'icon-angle-left bigger-140',
          'ui-icon-seek-next' : 'icon-angle-right bigger-140',
          'ui-icon-seek-end' : 'icon-double-angle-right bigger-140'
        };
        $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function(){
          var icon = $(this);
          var $class = $.trim(icon.attr('class').replace('ui-icon', ''));
          
          if($class in replacement) icon.attr('class', 'ui-icon '+replacement[$class]);
        })
      }

      //异步删除
      function _ajax_del(ids){
          var _json;
          $.ajax({  
              type:'get',  
              url : 'http://'+api_url+'/Default.ashx?TaskID=4008&ProblemID='+ids,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code == 0){
                      _json=json;
                      layer.msg(json.msg);
                      var selectRow = $("#grid-table").jqGrid('getGridParam','selrow');
                      $("#grid-table").delRowData(selectRow);
                  }else{
                      layer.msg(json.msg);
                      _json=json;
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;
      }

      jQuery(function($) {
        _ajax_get_type_1();
        _ajax_get_type_2();

        reload_grid_table();

        //定时刷新停线列表
        setInterval(function(){
            reload_grid_table();
        }, 60000);

      
        //初使化按钮操作权限
        var page="{$page}";
        _init_button_operate(page);
      
      });
    </script>
    
    <!-- 模板引擎doT.js    start -->
    <script id="j-tmpl" type="text/template">
        {{ if(it.success){ }}

                {{ for (var i = 0, l = it.data.length; i < l; i++) { }}

                      <tr>
                        <td class="center">
                          <label>
                            <input type="checkbox" class="ace" />
                            <span class="lbl"></span>
                          </label>
                        </td>
                        <td>
                          <a href="#">{{=it.data[i].id}}</a>
                        </td>
                        <td>{{=it.data[i].title}}</td>
                        <td class="hidden-480">{{=it.data[i].time}}</td>
                        <td>{{=it.data[i].username}}</td>
                        <td class="hidden-480">
                          <span class="label label-sm label-warning">待判定</span>
                        </td>
                        <td>
                          <div class="visible-md visible-lg hidden-sm hidden-xs btn-group">
                            <button class="btn btn-xs btn-success">
                              <i class="icon-ok bigger-120"></i>
                            </button>
                            <button class="btn btn-xs btn-info">
                              <a href="#modal-form" role="button" data-toggle="modal"><i class="icon-edit bigger-120"></i></a>
                            </button>
                            <button class="btn btn-xs btn-danger">
                              <i class="icon-trash bigger-120"></i>
                            </button>
                            <button class="btn btn-xs btn-warning">
                              <i class="icon-flag bigger-120"></i>
                            </button>
                          </div>
                          <div class="visible-xs visible-sm hidden-md hidden-lg">
                            <div class="inline position-relative">
                              <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown">
                                <i class="icon-cog icon-only bigger-110"></i>
                              </button>
                              <ul class="dropdown-menu dropdown-only-icon dropdown-yellow pull-right dropdown-caret dropdown-close">
                                <li>
                                  <a href="#" class="tooltip-info" data-rel="tooltip" title="View">
                                    <span class="blue">
                                      <i class="icon-zoom-in bigger-120"></i>
                                    </span>
                                  </a>
                                </li>
                                <li>
                                  <a href="#" class="tooltip-success" data-rel="tooltip" title="Edit">
                                    <span class="green">
                                      <i class="icon-edit bigger-120"></i>
                                    </span>
                                  </a>
                                </li>
                                <li>
                                  <a href="#" class="tooltip-error" data-rel="tooltip" title="Delete">
                                    <span class="red">
                                      <i class="icon-trash bigger-120"></i>
                                    </span>
                                  </a>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </td>
                      </tr>

                {{ } }}

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}
    </script>

    <script id="j-tmpl-bl-list" type="text/template">

        {{ if(it.code == 0){ }}

                {{ for (var i = 0, l = it.data.length; i < l; i++) { }}

                      <tr data-ID="{{=it.data[i].RowID}}" data-M_Number="{{=it.data[i].M_MNumber}}" data-M_Procedure="{{=it.data[i].M_Name}}">
                        <td class="center">
                        </td>
                        <td>{{=it.data[i].RowID}}</td>
                        <td>{{=it.data[i].M_MNumber}}</td>
                        <td>{{=it.data[i].M_Name}}</td>
                      </tr>

                {{ } }}

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}
        
    </script>
    <script src="__PUBLIC__/Admin/doT-master/doT.js"></script>
    <script type="text/javascript">
        $(function(){
            //smartMenu右键自定义上下文菜单插件初使化
            Fn_Init_smartMenu();
            
            $('.ui-state-default.ui-jqgrid-hdiv').click(function(){
                Fn_Init_smartMenu();
            });

            $('.ui-jqgrid-bdiv').click(function(){
                Fn_Init_smartMenu();
            });
        });
    </script>
    <!-- 模板引擎doT.js    end -->
    



    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <script type="text/javascript" src="__PUBLIC__/Admin/jquery-smartMenu/js/jquery-smartMenu.js"></script>
    <script>
        function Fn_Init_smartMenu(){
            var chkSingle = $("th input"), chkGroup = $("td input");
            var funTrStyle = function() {
              chkGroup.each(function() {
                if ($(this).attr("checked")) {
                  $(this).parents("tr").addClass("bg"); 
                } else {
                  $(this).parents("tr").removeClass("bg");  
                }
              });
            }, funTrGet = function() {
              return  $("td input:checked").parents("tr");
            };

            chkSingle.bind("click", function() {
              if ($(this).attr("checked")) {
                chkGroup.attr("checked", "checked");
              } else {
                chkGroup.attr("checked", "");
              }
              funTrStyle(); 
            });

            chkGroup.bind("click", funTrStyle);
            funTrStyle();

            //自定义右键上下文
            var objDelete = {
              text: "删除",
              func: function() {
                  $('#del_grid-table').trigger('click');
              } 
            }, objShow = {
              text: "查看",
              func: function() {
                  $('#view_grid-table').trigger('click');
              } 
            }, objEdit = {
              text: "编辑",
              func: function() {
                  $('#edit_grid-table').trigger('click');
              }
            }, objUnRead = {}, objSend = {};

            var mailMenuData = [
              [objDelete, objShow]
            ];

            $("#grid-table>tbody>tr").smartMenu(mailMenuData, {
              name: "mail",
              beforeShow: function() {    
                //根据选中的是否是已读显示不同的上下文菜单
                $(this).find("input").attr("checked", "checked"); 
                funTrStyle();

                //动态数据，及时清除
                $.smartMenu.remove();

                //确定显示数据 - 主要是已读与未读
                var numTrBold = 0, numTrNormal = 0, eleTr = funTrGet();
                eleTr.each(function() {
                  if ($(this).css("font-weight") === "700") {
                    numTrBold++; 
                  } 
                  if ($(this).css("font-weight") === "400") {
                    numTrNormal++;  
                  }
                });

                if (eleTr.size() === numTrBold) {
                  //全是粗体  
                  mailMenuData[1] = [objEdit];
                } else if (eleTr.size() === numTrNormal) {
                  //全是正常
                  mailMenuData[1] = [objEdit];
                } else {
                  //混杂
                  mailMenuData[1] = [objEdit];
                }
              }
            });
        }
    </script>
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->


    <!-- 添加模具 start-->
    <div id="dialog-confirm" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">
            
            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">创建人</label>
                          <div class="layui-input-inline">
                            <input type="text" name="_problem_id" style="display:none;" id="_problem_id" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                            <input type="text" name="_creater" lay-verify="required" placeholder="创建人" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">审核人</label>
                          <div class="layui-input-inline">
                            <input type="text" name="_auditer" lay-verify="required" placeholder="审核人" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">模具</label>
                          <div class="layui-input-inline">
                            <input type="text" name="_mould_name" id="_mould_name" lay-verify="required" placeholder="模具名称" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                            <input type="text" name="_mould_id" id="_mould_id" style="display:none;" lay-verify="required" placeholder="模具ID" autocomplete="off" class="layui-input">
                            <input type="text" name="_mould_no" id="_mould_no" style="display:none;" lay-verify="required" placeholder="模具编号" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td style="text-align:right;">
                      <button class="layui-btn" lay-submit="" lay-filter="demo_scgd">确定</button>
                    </td>
                  </tr>
                  
                </tbody>
            </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 添加模具 start-->
    <div id="dialog-confirm_add" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">
            
            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">开始时间</label>
                          <div class="layui-input-inline">
                            <input class="layui-input" name="start_time" id="start_time" lay-verify="required" placeholder="开始时间" onclick="layui.laydate({elem: this, istime: true, format: 'YYYY/MM/DD hh:mm',festival:true})">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">结束时间</label>
                          <div class="layui-input-inline">
                            <input class="layui-input" name="end_time" id="end_time" lay-verify="required" placeholder="结束时间" onclick="layui.laydate({elem: this, istime: true, format: 'YYYY/MM/DD hh:mm',festival:true})">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">产线</label>
                          <div class="layui-input-inline">
                             <select name="Line" class="Line" lay-filter="aihao">
                               <option value="A" selected>A</option>
                               <option value="B">B</option>
                             </select>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>


                  <tr>
                    <td colspan="3" style="text-align:right;">
                      <button class="layui-btn" lay-submit="" lay-filter="demo1_add">确定</button>
                    </td>
                  </tr>
                  
                </tbody>
            </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 板料信息 start-->
    <div id="dialog-confirm_bl_info" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">
            
            <table id="sample-table-1-2" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" placeholder="关键词" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div> 
                    </td>
                    <td>
                      <button class="layui-btn bl_keyword_btn" lay-submit="" lay-filter="demo_mj">搜索</button>
                    </td>
                  </tr>
                  
                </tbody>
              </table>

           </form>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <div class="table-responsive">
              <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <thead>
                  <tr>
                    <th class="center">
                    </th>
                    <th>模具id</th>
                    <th>模具编号</th>
                    <th>模具名称</th>
                  </tr>
                </thead>

                <tbody id="_bl_list">

                </tbody>
              </table>
            </div><!-- /.table-responsive -->
          </div><!-- /span -->
        </div>
    </div><!-- #dialog-confirm -->

    <script type="text/javascript">

        $(function(){
            //选择一行时
            $('body').on('click','#grid-table tr',function(){
                
            });

        });
        
    </script>
  <!-- _dialog=========================================== -->
  <!-- layui.js   -->
<!-- 确认弹框 start-->
<style type="text/css">
  .layui-form-label {
      padding: 9px 10px;
  }
</style>



<script type="text/javascript">
    $(function(){
        //生成工单
        $( ".id-btn-dialog2" ).on('click', function(e) {
          e.preventDefault();

          if(!$('#demo1_save').attr('data-mould-id')){
          	alert('请先选择一行！');
          	return false;
          }


          var _problem_id=$(this).attr('data-mould-id');
          var _Type2ID=$('#select_4 option:selected').val();


          $('#_problem_id').val(_problem_id);
          
          $( "#dialog-confirm" ).removeClass('hide').dialog({
            resizable: false,
            modal: true,
            title: "",
            width:'250',
            title_html: true,
          });

          $("div[aria-describedby='dialog-confirm'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 生成工单：</h4></div>");
        });

        //添加
        $( "#id-btn-dialog2_add" ).on('click', function(e) {
          e.preventDefault();

          var _problem_id=$(this).attr('data-mould-id');
          $('#_problem_id').val(_problem_id);
          
          $( "#dialog-confirm_add" ).removeClass('hide').dialog({
            resizable: false,
            modal: true,
            title: "",
            width:'1200',
            title_html: true,
          });

          $("div[aria-describedby='dialog-confirm_add'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加：</h4></div>");
        });


        //模具列表信息
        $( "body" ).on('click', '.id-btn-dialog2_bl_info', function(e) {
          e.preventDefault();
          $('.bl_keyword_btn').trigger('click');
          //初使化板料信息
          // get_bl_list(__name);
          
          $( "#dialog-confirm_bl_info" ).removeClass('hide').dialog({
            resizable: false,
            modal: true,
            title: "",
            width:800,
            height:500,
            title_html: true,
            buttons: [
              {
                html: "<i class='icon-remove bigger-110'></i>&nbsp; 取消",
                "class" : "btn btn-xs auto_close",
                click: function() {
                  $( this ).dialog( "close" );
                }
              }
            ]
          });

          $("div[aria-describedby='dialog-confirm_bl_info'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 模具列表信息：</h4></div>");
        });

        //选择模具信息行
        $('body').on('click','#_bl_list tr',function(){　
            var ID=$(this).attr('data-ID');　
            var M_Number=$(this).attr('data-M_Number');
            var M_Procedure=$(this).attr('data-M_Procedure');

            $('#_mould_name').val(M_Procedure);
            $('#_mould_id').val(ID);
            $('#_mould_no').val(M_Number);
            var form = layui.form();
            form.render();

            $("div[aria-describedby='dialog-confirm_bl_info'] .auto_close").trigger("click");
        });

        //删除
        $( "body" ).on('click', '.id-btn-dialog2_del', function() {
          if(confirm("确定要删除？")){
              var ids=$(this).attr('data-id');
              _ajax_del(ids);
          }
        });

    });
</script>
<!-- 确认弹框 end-->

<script>
      layui.use(['form', 'laydate'], function(){
        var form = layui.form()
        ,layer = layui.layer
        ,layedit = layui.layedit
        ,laydate = layui.laydate;

        //自定义验证规则
        form.verify({
          title: function(value){
            if(value.length < 5){
              return '标题至少得5个字符啊';
            }
          }
          ,pass: [/(.+){6,12}$/, '密码必须6到12位']
          ,content: function(value){
            layedit.sync(editIndex);
          }
        });

        var start = {
          max: '2099-06-16 23:59:59'
          ,istoday: false
          ,choose: function(datas){
            end.min = datas; //开始日选好后，重置结束日的最小日期
            end.start = datas //将结束日的初始值设定为开始日
          }
        };

        var end = {
          max: '2099-06-16 23:59:59'
          ,istoday: false
          ,choose: function(datas){
            start.max = datas; //结束日选好后，重置开始日的最大日期
          }
        };

        document.getElementById('LAY_demorange_s').onclick = function(){
          start.elem = this;
          laydate(start);
        }

        document.getElementById('LAY_demorange_e').onclick = function(){
          end.elem = this
          laydate(end);
        }

        //select_2改变
        form.on('select(select_2)', function(data) {
          var rowId = $(grid_selector).jqGrid('getGridParam','selrow');
          var rowData = $(grid_selector).jqGrid('getRowData',rowId);
          var Line=rowData.Line;

          if(!Line){
            alert('请先选择一行！');
            return false;
          }

          var Type2ID=data.value;   //停线原因

          if(Type2ID=="2"){
              render_select_3(0);
          }else{
              $('#select_3_box').hide().html('');
          }

          var str_1 = "";

          

          $.ajax({
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4003',
              dataType : 'json',
              data:{
                   Type2ID:Type2ID,
                   Line:Line
              },
              success: function(json) {
                 if (json.data != null) {
                    var jsonobj=json.data;
                    var length = jsonobj.length;
                    str_1+="<option value='请选择'>全部</option>";
                    for (var i = 0; i < length; i++) {   //循环option
                        if (i != length - 1) {
                            str_1 += "<option value="+jsonobj[i].PartID+">" + jsonobj[i].PartName + "</option>;";
                        } else {
                            str_1 += "<option value="+jsonobj[i].PartID+">" + jsonobj[i].PartName + "</option>";
                        }
                    }
                  }
               }
          });


          $("#select_4").html(str_1);
          layui.form().render();
        });


        //select_4改变
        form.on('select(select_4)', function(data) {
          var PartID=data.value;   //停线原因

          var rowId = $(grid_selector).jqGrid('getGridParam','selrow');
          var rowData = $(grid_selector).jqGrid('getRowData',rowId);
          var Line=rowData.Line;

          var str_2 = "";
          $.ajax({
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=4004',
              dataType : 'json',
              data:{
                   PartID:PartID,
                   Line:Line
              },
              success: function(json) {
                 if (json.data != null) {
                    var jsonobj=json.data;
                    var length = jsonobj.length;
                    str_2+="<option value='请选择'>全部</option>";
                    for (var i = 0; i < length; i++) {   //循环option
                        if (i != length - 1) {
                            str_2 += "<option value="+jsonobj[i].DescribeID+">" + jsonobj[i].DescribeName + "</option>;";
                        } else {
                            str_2 += "<option value="+jsonobj[i].DescribeID+">" + jsonobj[i].DescribeName + "</option>";
                        }
                    }
                  }
               }
          });

          $("#select_5").html(str_2);
          layui.form().render();
        });



        //监听提交
        form.on('submit(demo1_save)', function(data){

          if(!$('#demo1_save').attr('data-mould-id')){
          	alert('请先选择一行！');
          	return false;
          }

          var Type2=data.field.Type2;
          var Part=data.field.Part;
          var Describe=data.field.Describe;
          var Remarks=data.field.Remarks;
          var StatusID=data.field.StatusID;
          var ID=data.field.ID;
          if(data.field.DeviceID){
              var DeviceID=data.field.DeviceID;
          }else{
              var DeviceID=0;
          }
          


          console.log(data);

          if(StatusID=="on"){
              StatusID=3;
          }else{
              StatusID=2;
          }

          var json=_ajax_stop_line_save(Type2,Part,Describe,Remarks,StatusID,ID,DeviceID);
          console.log(json);

          if(json.code==0){
            reload_grid_table();
          }
          return false;
        });


        //监听提交
        form.on('submit(demo1_make_gongdan)', function(data){

          var rowId = $(grid_selector).jqGrid('getGridParam','selrow');
          var rowData = $(grid_selector).jqGrid('getRowData',rowId);
          var Status=rowData.Status;
          if($(Status).html()=='未维护'){
              alert('未维护记录不能生成工单!');
              return false;
          }

          var ID=$('#make_gongdan').attr('data-mould-id');
          var DieID=$('#make_gongdan').attr('data-DieID');
          if(!ID){
          	alert('请先选择一行！');
          	return false;
          }

          var DeviceID=data.field.Describe;
          if(DeviceID>=0){
              var Type2ID = DeviceID;
          }else{
              var Type2ID = $('#select_4 option:selected').val();
          }
          var ProblemID =ID;
          var TypeID = DieID;
          
          var Flag=data.field.Type2;

              if(Flag=='模具'){
                  Flag=1;
              }
              if(Flag=='设备'){
                  Flag=3;
              }
              if(Flag=='生产'){
                  Flag=4;
              }
              if(Flag=='其它'){
                  alert('不能生成工单!');
                  return;
              }

          var OrderType = "维修工单";
          var Creater=login_user;

          var json=_ajax_add_gongdan(ProblemID, Creater, TypeID, OrderType, Type2ID, Flag);

          if(json.code==0){
            reload_grid_table();
          }
          return false;
        });


        //监听提交
        form.on('submit(demo1_add)', function(data){

          var start_time=data.field.start_time;
          var end_time=data.field.end_time;
          var Line=data.field.Line;

          var json=_ajax_stop_line_add(start_time,end_time,Line);

          if(json.code==0){
            reload_grid_table();
          }
          return false;
        });

        //监听提交
        form.on('submit(demo_scgd)', function(data){
            var _ProblemID=data.field._problem_id;
            var _Creater=data.field._creater;
            var _Auditer=data.field._auditer;
            var _TypeID=data.field._mould_id;
            var _Type2ID=$('#select_4 option:selected').val();
            var _Flag=$('#select_2 option:selected').text();

                if(_Flag=='模具'){
                    _Flag=1;
                }
                if(_Flag=='设备'){
                    _Flag=3;
                }
                if(_Flag=='生产'){
                    _Flag=4;
                }
                if(_Flag=='其它'){
                    alert('不能生成工单!');return;
                }

            var _OrderType = "维修工单";



            var json=_ajax_add_gongdan(ProblemID, Creater, TypeID, OrderType, Type2ID, Flag);

            console.log(json);
          layer.alert(JSON.stringify(data.field), {
            title: '最终的提交信息333'
          })
          return false;
        });

      });
</script>

    <script type="text/javascript">
        $(function(){
            //导出问题列表
            $('#export_list').click(function(){
                var Line=$('#search_table .Line').val();
                var Status=$('#search_table .Status').val();
                var Date1=$('#search_table .Date1').val();
                var Date2=$('#search_table .Date2').val();
                
                _ajax_export_list(Line, Status, Date1, Date2);
            });
        });

        function _ajax_export_list(Line, Status, Date1, Date2){
            $.ajax({  
                async:false,
                type:'get',  
                contentType:"application/x-www-form-urlencoded",
                url : 'http://'+api_url+'/Default.ashx?TaskID=41071',
                data: {'Line':Line, 'Status':Status, 'Date1':Date1, 'Date2':Date2},
                dataType : 'json',
                success  : function(json) { 
                    if(json.code==0){
                        var download_url='http://'+api_url+'/'+json.data;
                        // console.log(download_url);return;

                        window.location.href=download_url;
                    }else{
                        layer.msg(json.msg);
                    }
                },
                error  : function(json) {  
                    layer.msg(json.msg);
                }  
            }); 
        }
    </script>
  </body>
</html>


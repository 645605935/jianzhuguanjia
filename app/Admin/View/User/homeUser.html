<include file="Public/header"/>
    <!-- basic styles -->
    <link href="__PUBLIC__/Admin/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome.min.css" />

    <!--[if IE 7]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome-ie7.min.css" />
    <![endif]-->

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.custom.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/chosen.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/bootstrap-timepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/daterangepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/colorpicker.css" />
    
    <!-- 模块jqgrid  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.full.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ui.jqgrid.css" />
    <!-- 模块jqgrid  end -->

    <!-- fonts -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/assets/css/google_font_css.css">

    <!-- ace styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-rtl.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-skins.min.css" />

    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/jquery-smartMenu/css/smartMenu.css" type="text/css" />
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->

    <link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">
    <link rel="stylesheet" href="__PUBLIC__/Admin/css/my_diy_css.css"  media="all">

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-ie.min.css" />
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->

    <script src="__PUBLIC__/Admin/assets/js/ace-extra.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.min.js"></script>
    <!-- layui.js   -->
    <script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>
    <script src="__PUBLIC__/layer/layer.js"></script>

    <!-- jquery获取地址栏参数 -->
    <script src="__PUBLIC__/js/jquery_get.js"></script>
    <script type="text/javascript">
      $(function(){
        console.log($.request.queryString);
      });
    </script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->



    <!--[if lt IE 9]>

    <script src="__PUBLIC__/Admin/assets/js/html5shiv.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/respond.min.js"></script>

    <![endif]-->

  </head>

  <body>
    <div class="navbar navbar-default" id="navbar">
      <include file="Public/navbar"/>
    </div>

    <div class="main-container" id="main-container">

      <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
      </script>

      <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
          <span class="menu-text"></span>
        </a>

        <!-- 左侧菜单栏 start-->
        <div class="sidebar" id="sidebar">
          <include file="Public/left"/>
        </div>
        
        <!-- 右侧主要内容 start-->
        <div class="main-content">
          

          <!-- 右block_1  start -->
          <div class="breadcrumbs" id="breadcrumbs">
            <script type="text/javascript">
              try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
            </script>

            <ul class="breadcrumb">
              <include file="Public/_breadcrumb"/>
            </ul><!-- .breadcrumb -->

            <div class="nav-search" id="nav-search">
              <form class="form-search">
                <span class="input-icon">
                  <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                  <i class="icon-search nav-search-icon"></i>
                </span>
              </form>
            </div><!-- #nav-search -->
          </div>
          <!-- 右block_1  end -->

          <div class="page-content">
            <!-- 权限设置  start -->
            <include file="Public/role_page_setting"/>
            <!-- 权限设置  end -->

            <div class="row">
              <div class="col-xs-12">

                <style>
                  .layui-form-item .layui-input-inline{width: auto!important;}
                  .layui-form-item{margin-bottom: 0px;}
                  #gbox_grid-table{width: 100%!important;}
                  #gview_grid-table{width: 100%!important;}
                  #gview_grid-table>div{width: 100%!important;}
                </style>

                <!-- 搜索  start -->
                <div class="row">
                    <form class="layui-form layui-form-pane col-xs-12" action="" method="post">
                        <table class="layui-table" id="search_table">
                          <thead>
                            <tr>
                              <th>搜索</th>
                            </tr> 
                          </thead>
                          <tbody>
                            <tr>
                              <td>

                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">用户名</label>
                                    <div class="layui-input-inline">
                                      <input type="text" name="username" value="{$_POST['username']}" placeholder="请输入" autocomplete="off" class="layui-input">
                                    </div>
                                  </div>
                                </div>  
                                
                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">用户组</label>
                                    <div class="layui-input-inline">
                                      <select name="gid">
                                        <option value="请选择">请选择</option>
                                        <foreach name="group" item="vo">
                                           <optgroup label="{$vo['title']}">
                                             <foreach name="vo['_child']" item="v">
                                               <option value="{$v.id}" <if condition="$v.id eq $_POST['gid']">selected</if>>{$v.title}</option>
                                             </foreach>
                                           </optgroup>
                                        </foreach>
                                      </select>
                                    </div>
                                  </div>
                                </div>  

                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                              <td>
                                <!-- <button style="float:left;" class="layui-btn id-btn-dialog2_add" title="id-btn-dialog2_add"> 添加用户 </button> -->
                                <a style="float:right;margin-left:10px;" href="{:U('Admin/User/homeUser')}" class="layui-btn search_btn" >刷新</a>
                                <button style="float:right;" type="submit" class="layui-btn search_btn" id="search_submit" name="submit" title="search_btn">搜索</button>
                              </td>
                            </tr> 
                          </tfoot>
                        </table>
                    </form>
                </div>
                <!-- 搜索  end -->

                <div class="row">
                    <div class="col-xs-7">
                        <div class="panel panel-default">
                          <div class="panel-heading">会员列表</div>
                          <div class="panel-body">
                            <table id="grid-table"></table>
                            <div id="grid-pager"></div>
                          </div>
                        </div>
                    </div>

                    <div class="col-xs-5">
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

                          <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingOne">
                              <h4 class="panel-title">
                                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne" class="collapsed">
                                  操作日志
                                </a>
                              </h4>
                            </div>
                            <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" aria-expanded="false" style="height: 0px;">
                              <div class="panel-body">
                                 <table id="grid-table-2"></table>
                                 <div id="grid-pager-2"></div>
                              </div>
                            </div>
                          </div>

                          <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingTwo">
                              <h4 class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                  买券记录
                                </a>
                              </h4>
                            </div>
                            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo" aria-expanded="false" style="height: 0px;">
                              <div class="panel-body">
                                 <table id="grid-table-3"></table>
                                 <div id="grid-pager-3"></div>
                              </div>
                            </div>
                          </div>

                          <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingTwo">
                              <h4 class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                  用券记录
                                </a>
                              </h4>
                            </div>
                            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo" aria-expanded="false" style="height: 0px;">
                              <div class="panel-body">
                                 <table id="grid-table-4"></table>
                                 <div id="grid-pager-4"></div>
                              </div>
                            </div>
                          </div>

                        </div>
                    </div>
                </div>

                <!-- PAGE CONTENT ENDS -->
              </div><!-- /.col -->
            </div><!-- /.row -->
          </div><!-- /.page-content -->

        </div><!-- /.main-content -->
        <!-- 右侧主要内容 end-->

        
        
        <!-- 模板相关设置 -->
        <include file="Public/ace-settings-container"/>

      </div><!-- /.main-container-inner -->



      <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">

        <i class="icon-double-angle-up icon-only bigger-110"></i>

      </a>

    </div><!-- /.main-container -->

    <!-- 底栏版本说明 -->
    <include file="Public/footer"/>

    <!-- basic scripts -->

    <!--[if !IE]> -->



    <!-- <![endif]-->



    <!--[if IE]>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<![endif]-->



    <!--[if !IE]> -->



    <script type="text/javascript">

      window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");

    </script>



    <!-- <![endif]-->



    <!--[if IE]>

<script type="text/javascript">

 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");

</script>

<![endif]-->



    <script type="text/javascript">

      if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");

    </script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/typeahead-bs2.min.js"></script>



    <!-- page specific plugin scripts -->

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.custom.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/chosen.jquery.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/fuelux/fuelux.spinner.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-timepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/moment.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/daterangepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-colorpicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.knob.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.autosize.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.inputlimiter.1.3.1.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.maskedinput.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-tag.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.bootstrap.js"></script>
    
    <!-- 模块jqgrid  start -->
    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/jquery.jqGrid.min.js"></script>
    <!-- <script src="__PUBLIC__/Admin/assets/js/jqGrid/grid.setcolumns.js"></script> -->
    <!-- <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-en.js"></script> -->
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-zh.js"></script>
    
    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.full.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>
    <!-- 模块jqgrid  end -->

    <!-- ace scripts -->
    <script src="__PUBLIC__/Admin/assets/js/jquery.nestable.min.js"></script>


    <script src="__PUBLIC__/Admin/assets/js/ace-elements.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/ace.min.js"></script>

    

    <!-- inline scripts related to this page -->


    <script type="text/javascript">
      $(function(){
          var _username="{$_POST['username']}";
          var _gid="{$_POST['gid']}";

          pageInit(_username, _gid);
      });

      function imgFormatter(cellvalue, options, rowdata){ 
          if (cellvalue != "0"){
              return '<img class="avatar" style="width:30px;height:30px;" src="'+cellvalue+'" alt="' + cellvalue + '" />';
          }else{
              return '<img class="avatar" style="width:30px;height:30px;" src="'+cellvalue+'" alt="' + cellvalue + '" />';
          }
      }

      function statusFormatter(cellvalue, options, rowdata){ 
          if (cellvalue == "1"){
              return '待审核';
          }else if(cellvalue == "2"){
              return '已认证';
          }else if(cellvalue == "-1"){
              return '禁止';
          }
      }

      function recommendFormatter(cellvalue, options, rowdata){ 
          if (cellvalue == "1"){
              return '是';
          }else{
              return '否';
          }
      }
      

      function pageInit(_username, _gid){
        var grid_data=_ajax_get_list(_username,_gid);

        jQuery(grid_selector).jqGrid({
          caption: "用户列表",
          data: grid_data,
          datatype: "local",
          colNames:['id', '公司名称','用户组', '公司LOGO', '时间', '状态', '首页', '操作'],
          colModel:[
            {name:'id', index:'id', sorttype:"int", align:"center", hidden: true},

            {name:'company_name',index:'company_name',align:"center"},
            {name:'_auth_group_title',index:'_auth_group_title',align:"center"},
            {name:'company_logo',index:'company_logo',align:"center", formatter: imgFormatter },
            {name:'time',index:'time',align:"center",hidden: true},
            {name:'status',index:'status',align:"center", formatter: statusFormatter},
            {name:'recommend',index:'recommend',align:"center", formatter: recommendFormatter},

            {name:'operates',index:'operates',align:'center',sortable:false,width:200}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          autowidth:true,
          viewrecords : true,
          rowNum:10,
          rowList:[10,20,30],
          pager : pager_selector,
          altRows: true,
          width:'100%',
          height: 700,
          multiselect: false,
          multiboxonly: true,
          sortable: true,
      
          loadComplete : function() {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          },

          onSelectRow : function(ids) {
            var _rowData = $('#grid-table').jqGrid('getRowData',ids); 
            var company_name=_rowData.company_name;

            //操作日志
            $('#grid-table-2').jqGrid('clearGridData');

            if (ids == null) {
              ids = 0;
              if (jQuery("#grid-table-2").jqGrid('getGridParam','records') > 0) {
                jQuery("#grid-table-2").jqGrid('setGridParam', {
                      url : "index.php?s=/Admin/User/ajax_get_user_relation_logs.html&id=" + ids,
                      page : 1
                    });
                jQuery("#grid-table-2").jqGrid('setCaption',"操作日志: " + company_name).trigger('reloadGrid');
              }
            } else {
              jQuery("#grid-table-2").jqGrid('setGridParam', {
                url : "index.php?s=/Admin/User/ajax_get_user_relation_logs.html&id=" + ids,
                page : 1
              });
              jQuery("#grid-table-2").jqGrid('setCaption',"操作日志: " + company_name).trigger('reloadGrid');
            }

            //买券记录
            $('#grid-table-3').jqGrid('clearGridData');

            if (ids == null) {
              ids = 0;
              if (jQuery("#grid-table-3").jqGrid('getGridParam','records') > 0) {
                jQuery("#grid-table-3").jqGrid('setGridParam', {
                      url : "index.php?s=/Admin/User/ajax_get_user_relation_coupon.html&id=" + ids,
                      page : 1
                    });
                jQuery("#grid-table-3").jqGrid('setCaption',"买券记录: " + company_name).trigger('reloadGrid');
              }
            } else {
              jQuery("#grid-table-3").jqGrid('setGridParam', {
                url : "index.php?s=/Admin/User/ajax_get_user_relation_coupon.html&id=" + ids,
                page : 1
              });
              jQuery("#grid-table-3").jqGrid('setCaption',"买券记录: " + company_name).trigger('reloadGrid');
            }

            //用券记录
            $('#grid-table-4').jqGrid('clearGridData');

            if (ids == null) {
              ids = 0;
              if (jQuery("#grid-table-4").jqGrid('getGridParam','records') > 0) {
                jQuery("#grid-table-4").jqGrid('setGridParam', {
                      url : "index.php?s=/Admin/User/ajax_get_user_relation_logs.html&id=" + ids,
                      page : 1
                    });
                jQuery("#grid-table-4").jqGrid('setCaption',"用券记录: " + company_name).trigger('reloadGrid');
              }
            } else {
              jQuery("#grid-table-4").jqGrid('setGridParam', {
                url : "index.php?s=/Admin/User/ajax_get_user_relation_logs.html&id=" + ids,
                page : 1
              });
              jQuery("#grid-table-4").jqGrid('setCaption',"用券记录: " + company_name).trigger('reloadGrid');
            }
          },

          gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
              var ids=jQuery(grid_selector).jqGrid('getDataIDs');
              for(var i=0; i<ids.length; i++){

                  var id=ids[i];   
                  var _rowData = $(grid_selector).jqGrid('getRowData',id);

                  var operates =""; 
                      operates += "<button style='margin-right:5px;' class='btn btn-warm btn-xs id-btn-dialog2_add-coupon' data-id='"+_rowData.id+"'>买券</button>";
                      operates += "<button style='margin-right:5px;' class='btn btn-primary btn-xs id-btn-dialog2_edit' data-id='"+_rowData.id+"'>编辑</button>";
                      operates += "<button class='btn btn-danger btn-xs id-btn-dialog2_del' data-id='"+_rowData.id+"'>删除</button>";

                  jQuery(grid_selector).jqGrid('setRowData', ids[i], { operates: operates });
              }
          },
        }).navGrid(pager_selector, {
          	search: false,
  	        add: false,
  	        edit: false,
  	        del: false,
  	        refresh: false
        });

        jQuery(grid_selector).closest(".ui-jqgrid-bdiv").css({ "overflow-x" : "hidden" });//去除jqgrid横向滚动条

        
        jQuery("#grid-table-2").jqGrid({
          url : "index.php?s=/Admin/User/ajax_get_user_relation_logs.html&id=0",
          datatype: "json",
          colNames:['id', '页面', '时间', '操作'],
          colModel:[
            {name:'id', index:'id', sorttype:"int", align:"center", hidden: true, editable: true ,sortable: false},

            {name:'username',index:'username',align:"center", editable: true,editrules: { required: true }},
            {name:'time',index:'time',align:"center", editable: true,editrules: { required: true }},
            {name:'url',index:'url',align:'center',sortable:false}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          rowNum:10,
          rowList:[10,100,1000],
          pager : '#grid-pager-2',
          viewrecords : true,
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          height : 250,
          caption : "操作日志",

          loadComplete : function(data) {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          }

        }).navGrid('#grid-pager-2', {
          add : false,
          edit : false,
          del : false
        });


        //优惠券
        jQuery("#grid-table-3").jqGrid({
          url : "index.php?s=/Admin/User/ajax_get_user_relation_coupon.html&id=0",
          datatype: "json",
          colNames:['id', '优惠券', '可用数量【张】', '到期时间', '操作'],
          colModel:[
            {name:'id', index:'id', sorttype:"int", align:"center", hidden: true, editable: true ,sortable: false},

            {name:'type',index:'type',align:"center", editable: true,editrules: { required: true }},
            {name:'num',index:'num',align:"center", editable: true,editrules: { required: true }},
            {name:'end_time',index:'end_time',align:"center", editable: true,editrules: { required: true }},

            {name:'options',index:'options',align:'center',sortable:false}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          rowNum:10,
          rowList:[10,100,1000],
          pager : '#grid-pager-3',
          viewrecords : true,
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          height : 250,
          caption : "操作日志",

          loadComplete : function(data) {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          },

          gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
              var ids=jQuery("#grid-table-3").jqGrid('getDataIDs');
              for(var i=0; i<ids.length; i++){

                  var id=ids[i];   
                  var _rowData = $("#grid-table-3").jqGrid('getRowData',id);

                  var options =""; 
                      options += "<button style='margin-right:5px;' class='btn btn-primary btn-xs id-btn-dialog2_edit_coupon' data-id='"+_rowData.id+"'>编辑</button>";
                      options += "<button class='btn btn-danger btn-xs id-btn-dialog2_del_coupon' data-id='"+_rowData.id+"'>删除</button>";

                  jQuery("#grid-table-3").jqGrid('setRowData', ids[i], { options: options });
              }
          },

        }).navGrid('#grid-pager-3', {
          add : false,
          edit : false,
          del : false
        });

        jQuery("#grid-table-4").jqGrid({
          url : "index.php?s=/Admin/User/ajax_get_user_relation_logs.html&id=0",
          datatype: "json",
          colNames:['id', '页面', '时间', '操作'],
          colModel:[
            {name:'id', index:'id', sorttype:"int", align:"center", hidden: true, editable: true ,sortable: false},

            {name:'username',index:'username',align:"center", editable: true,editrules: { required: true }},
            {name:'time',index:'time',align:"center", editable: true,editrules: { required: true }},
            {name:'url',index:'url',align:'center',sortable:false}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          rowNum:10,
          rowList:[10,100,1000],
          pager : '#grid-pager-4',
          viewrecords : true,
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          height : 250,
          caption : "操作日志",

          loadComplete : function(data) {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          }

        }).navGrid('#grid-pager-4', {
          add : false,
          edit : false,
          del : false
        });

        //更新分页图标  
        function updatePagerIcons(table) {
          var replacement = 
          {
            'ui-icon-seek-first' : 'icon-double-angle-left bigger-140',
            'ui-icon-seek-prev' : 'icon-angle-left bigger-140',
            'ui-icon-seek-next' : 'icon-angle-right bigger-140',
            'ui-icon-seek-end' : 'icon-double-angle-right bigger-140'
          };
          $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function(){
            var icon = $(this);
            var $class = $.trim(icon.attr('class').replace('ui-icon', ''));
            
            if($class in replacement) icon.attr('class', 'ui-icon '+replacement[$class]);
          })
        }
      }
    </script>
   
    
    <!-- 模板引擎doT.js    start -->
    <script id="j-tmpl" type="text/template">
        <tr>
          <td class="center">
            <div class="layui-inline">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input class="layui-input" placeholder="板料计划时间" onclick="layui.laydate({elem: this, istime: true, format: 'YYYY-MM-DD hh:mm:ss'})">
                </div>
              </div>
            </div>
          </td>
          <td>
            <div class="layui-inline">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input type="text" name="keyword" lay-verify="required" placeholder="板料名称" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                </div>
              </div>
            </div>
            <div class="layui-inline" style="display:none;">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input type="text" name="keyword" lay-verify="required" placeholder="" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-3">
                </div>
              </div>
            </div>
          </td>
          <td>
            <div class="layui-inline">
              <div class="layui-form-item">
                <div class="layui-input-inline">
                  <input type="text" name="keyword" lay-verify="required" placeholder="数量" autocomplete="off" class="layui-input item-4">
                </div>
              </div>
            </div> 
          </td>
          <td>
          </td>
        </tr>
    </script>

    <script id="j-tmpl_detail_show" type="text/template">
        {{ if(it.code == 0){ }}

            <table class="layui-table">
              <colgroup>
                <col width="150">
                <col>
              </colgroup>
              <tbody>
                <tr>
                  <td>姓名</td>
                  <td>{{=it.data.truename}}</td>
                </tr>
                <tr>
                  <td>用户名</td>
                  <td>{{=it.data.username}}</td>
                </tr>
              </tbody>
            </table>

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}
    </script>

    
    <script src="__PUBLIC__/Admin/doT-master/doT.js"></script>
    <!-- 模板引擎doT.js    end -->

    <div id="dialog-confirm_add" class="hide">
       <div class="row">
             <form class="layui-form layui-form-pane col-xs-12" method="post" action="" id="add_form" enctype="multipart/form-data">
              
                <table class="table table-striped table-bordered table-hover">
                  <tbody>
                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">用户名</label>
                            <div class="layui-input-inline">
                              <input type="text" name="username" lay-verify="required" placeholder="" class="layui-input username">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">用户组</label>
                            <div class="layui-input-inline">
                              <select name="gid" class="gid">
                                <option value="请选择">请选择</option>
                                <foreach name="group" item="vo">
                                   <optgroup label="{$vo['title']}">
                                     <foreach name="vo['_child']" item="v">
                                       <option value="{$v.id}">{$v.title}</option>
                                     </foreach>
                                   </optgroup>
                                </foreach>
                              </select>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">公司名称</label>
                            <div class="layui-input-inline">
                              <input type="text" name="company_name" lay-verify="required" placeholder="" class="layui-input company_name">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">密码</label>
                            <div class="layui-input-inline">
                              <input type="text" name="password" lay-verify="required" placeholder="" class="layui-input password">
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">邮箱</label>
                            <div class="layui-input-inline">
                              <input type="text" name="email" lay-verify="required" placeholder="" class="layui-input email">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">手机</label>
                            <div class="layui-input-inline">
                              <input type="text" name="phone" lay-verify="required" placeholder="" class="layui-input phone">
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">LOGO</label>
                            <div class="layui-input-inline">
                              <input type="file" id="add_upload_img" name="file" class="layui-upload-file">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <img class="show_img" data-src="holder.js/140x140" class="img-thumbnail" alt="140x140" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgdmlld0JveD0iMCAwIDE0MCAxNDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjwhLS0KU291cmNlIFVSTDogaG9sZGVyLmpzLzE0MHgxNDAKQ3JlYXRlZCB3aXRoIEhvbGRlci5qcyAyLjYuMC4KTGVhcm4gbW9yZSBhdCBodHRwOi8vaG9sZGVyanMuY29tCihjKSAyMDEyLTIwMTUgSXZhbiBNYWxvcGluc2t5IC0gaHR0cDovL2ltc2t5LmNvCi0tPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbI2hvbGRlcl8xNWQ1MzI3ODU3YiB0ZXh0IHsgZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQgfSBdXT48L3N0eWxlPjwvZGVmcz48ZyBpZD0iaG9sZGVyXzE1ZDUzMjc4NTdiIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjQ1IiB5PSI3NC44Ij4xNDB4MTQwPC90ZXh0PjwvZz48L2c+PC9zdmc+" data-holder-rendered="true" style="width: 140px; height: 140px;">
                      </td>
                    </tr>

                    <tr>
                      <td class="center" colspan="2">
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label" style="width: 100%!important;text-align: left;">简介</label>
                            <div class="layui-input-block">
                                <textarea class="layui-textarea layui-hide company_introduction" name="company_introduction" lay-verify="content" id="editer_add"></textarea>
                            </div>
                        </div>
                      </td>
                    </tr>
                    
                    <tr>
                      <td colspan="2">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">状态</label>
                            <div class="layui-input-inline">
                              <input type="radio" name="open" class="open" value="1" title="开" checked="">
                              <input type="radio" name="open" class="open" value="0" title="关">
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td colspan="2">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">推荐至首页</label>
                            <div class="layui-input-inline">
                              <input type="radio" name="recommend" class="recommend" value="1" title="是">
                              <input type="radio" name="recommend" class="recommend" value="0" title="否" checked="">
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                   
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colspan="2" style="text-align:right;">
                        <input type="hidden" name="company_logo" lay-verify="required" class="layui-input company_logo" readonly>
                        <button class="layui-btn" lay-submit="" lay-filter="demo1_add">确认</button>
                        <button type="reset" class="layui-btn layui-btn-primary reset">重置</button>
                      </td>
                    </tr>
                  </tfoot>
                </table>

             </form>
        </div>
    </div><!-- #dialog-confirm -->

    <div id="dialog-confirm_add-coupon" class="hide">
       <div class="row">
             <form class="layui-form layui-form-pane col-xs-12" method="post" action="" id="add_form-coupon" enctype="multipart/form-data">
              
                <table class="table table-striped table-bordered table-hover">
                  <tbody>
                    <tr>
                      <td colspan="2">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">优惠券类型</label>
                            <div class="layui-input-inline">
                              <select name="type" class="type" lay-verify="required" >
                                <option value="">请选择</option>
                                <foreach name="coupon_type" item="v">
                                    <option value="{$v.id}">{$v.title}【{$v.num}张】【{$v.day}天】【{$v.price}元】</option>
                                </foreach>
                              </select>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                    
                    <tr>
                      <td colspan="2">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">状态</label>
                            <div class="layui-input-inline">
                              <input type="radio" name="status" class="status" value="1" title="正常" checked="">
                              <input type="radio" name="status" class="status" value="0" title="禁止">
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                   
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colspan="2" style="text-align:right;">
                        <input type="hidden" name="uid" lay-verify="required" class="layui-input uid" readonly>
                        <button class="layui-btn" lay-submit="" lay-filter="demo1_add-coupon">确认</button>
                        <button type="reset" class="layui-btn layui-btn-primary reset">重置</button>
                      </td>
                    </tr>
                  </tfoot>
                </table>

             </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 确认弹框 start-->
    <div id="dialog-confirm_edit" class="hide">
       <div class="row">
             <form class="layui-form layui-form-pane col-xs-12" method="post" action="" id="edit_form" enctype="multipart/form-data">
                            
                <table class="table table-striped table-bordered table-hover">
                  <tbody>
                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">用户名</label>
                            <div class="layui-input-inline">
                              <input type="text" name="username" placeholder="" class="layui-input username">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">用户组</label>
                            <div class="layui-input-inline">
                              <select name="gid" class="gid">
                                <option value="请选择">请选择</option>
                                <foreach name="group" item="vo">
                                   <optgroup label="{$vo['title']}">
                                     <foreach name="vo['_child']" item="v">
                                       <option value="{$v.id}" alt="{$v.id}">{$v.title}</option>
                                     </foreach>
                                   </optgroup>
                                </foreach>
                              </select>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                    
                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">公司名称</label>
                            <div class="layui-input-inline">
                              <input type="text" name="company_name" lay-verify="required" placeholder="" class="layui-input company_name">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">密码</label>
                            <div class="layui-input-inline">
                              <input type="text" name="password" placeholder="如果密码不保持不变，则不用填写" class="layui-input password">
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">邮箱</label>
                            <div class="layui-input-inline">
                              <input type="text" name="email" placeholder="" class="layui-input email">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">手机</label>
                            <div class="layui-input-inline">
                              <input type="text" name="phone" lay-verify="required" placeholder="" class="layui-input phone">
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td>
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">LOGO</label>
                            <div class="layui-input-inline">
                              <input type="file" id="edit_upload_img" name="file" class="layui-upload-file">
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <img class="show_img" data-src="holder.js/140x140" class="img-thumbnail" alt="140x140" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgdmlld0JveD0iMCAwIDE0MCAxNDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjwhLS0KU291cmNlIFVSTDogaG9sZGVyLmpzLzE0MHgxNDAKQ3JlYXRlZCB3aXRoIEhvbGRlci5qcyAyLjYuMC4KTGVhcm4gbW9yZSBhdCBodHRwOi8vaG9sZGVyanMuY29tCihjKSAyMDEyLTIwMTUgSXZhbiBNYWxvcGluc2t5IC0gaHR0cDovL2ltc2t5LmNvCi0tPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbI2hvbGRlcl8xNWQ1MzI3ODU3YiB0ZXh0IHsgZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQgfSBdXT48L3N0eWxlPjwvZGVmcz48ZyBpZD0iaG9sZGVyXzE1ZDUzMjc4NTdiIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjQ1IiB5PSI3NC44Ij4xNDB4MTQwPC90ZXh0PjwvZz48L2c+PC9zdmc+" data-holder-rendered="true" style="width: 140px; height: 140px;">
                      </td>
                    </tr>

                    <tr>
                      <td class="center" colspan="2">
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label" style="width: 100%!important;text-align: left;">简介</label>
                            <div class="layui-input-block">
                                <textarea class="layui-textarea layui-hide company_introduction" name="company_introduction" lay-verify="content" id="editer_edit"></textarea>
                            </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td colspan="2">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">状态</label>
                            <div class="layui-input-inline status_box">
                              
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td colspan="2">
                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">推荐至首页</label>
                            <div class="layui-input-inline recommend_box">
                              
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                   
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colspan="2" style="text-align:right;">
                        <input type="hidden" name="id" lay-verify="required" class="layui-input id" readonly>
                        <input type="hidden" name="company_logo" lay-verify="required" class="layui-input company_logo" readonly>
                        <button class="layui-btn" lay-submit="" lay-filter="demo1_edit">确认</button>
                        <button type="reset" class="layui-btn layui-btn-primary reset">重置</button>
                      </td>
                    </tr>
                  </tfoot>
                </table>

             </form>
           
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 确认弹框 start-->
    <div id="dialog-confirm_editer" class="hide">
        <iframe src="" id="editer" name="editer" width="100%" height="100%" frameborder="0" scrolling="no" marginwidth="0" marginheight="0"></iframe>
    </div><!-- #dialog-confirm -->
    
    <!-- 详情 start-->
    <div id="dialog-confirm_show" class="hide">
       
    </div><!-- #dialog-confirm -->
    
  
    <script type="text/javascript">
        $(function(){
            //添加用户
            $( "body" ).on('click', '.id-btn-dialog2_add', function(e) {
              e.preventDefault();
              
              init_editer('editer_add');

              $( "#dialog-confirm_add" ).removeClass('hide').dialog({
                resizable: false,
                modal: true,
                title: "",
                width:800,
                title_html: true,
              });

              $("div[aria-describedby='dialog-confirm_add'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加用户：</h4></div>");
            });

            //买券
            $( "body" ).on('click', '.id-btn-dialog2_add-coupon', function(e) {
              e.preventDefault();
              
              $('#add_form-coupon .uid').val($(this).attr('data-id'));
              init_editer('editer_add-coupon');

              $( "#dialog-confirm_add-coupon" ).removeClass('hide').dialog({
                resizable: false,
                modal: true,
                title: "",
                width:800,
                title_html: true,
              });

              $("div[aria-describedby='dialog-confirm_add-coupon'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加买券记录：</h4></div>");
            });

            //编辑
            $( "body" ).on('click','.id-btn-dialog2_edit', function(e) {
              e.preventDefault();

              var id=$(this).attr('data-id');
              if(id){
                  var _json=_ajax_get_row_info(id);
                  if(_json.code==0){
                      init_editer('editer_edit');

                      $( "#dialog-confirm_edit" ).removeClass('hide').dialog({
                        resizable: false,
                        modal: true,
                        title: "",
                        width:800,
                        title_html: true,
                      });

                      $("div[aria-describedby='dialog-confirm_edit'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 编辑：</h4></div>");
                  }
              }
            });

            //删除
            $( "body" ).on('click', '.id-btn-dialog2_del', function() {
              if(confirm("确定要删除？")){
                  var ids=$(this).attr('data-id');
                  _ajax_del(ids);
              }
            });

            //编辑优惠券
            $( "body" ).on('click','.id-btn-dialog2_edit_coupon', function(e) {
              e.preventDefault();

              var id=$(this).attr('data-id');
              if(id){
                  var _json=_ajax_get_row_info(id);
                  if(_json.code==0){
                      init_editer('editer_edit');

                      $( "#dialog-confirm_edit" ).removeClass('hide').dialog({
                        resizable: false,
                        modal: true,
                        title: "",
                        width:800,
                        title_html: true,
                      });

                      $("div[aria-describedby='dialog-confirm_edit'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 编辑：</h4></div>");
                  }
              }
            });

            //删除优惠券
            $( "body" ).on('click', '.id-btn-dialog2_del_coupon', function() {
              if(confirm("确定要删除？")){
                  var ids=$(this).attr('data-id');
                  _ajax_del(ids);
              }
            });
        });
    </script>
    <!-- 确认弹框 end-->

    <script type="text/javascript">
       //获取列表
       function _ajax_get_list(_username,_gid){
          var grid_data;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : "{:U('Admin/User/ajax_get_user_list')}",
              data: {'username':_username, 'gid':_gid},
              dataType : 'json',
              success  : function(json) { 
                  if(json.code==0){
                      // layer.msg(json.msg);
                      grid_data=json.data;
                  }else{
                      layer.msg(json.msg);
                  }
              }
          });  
          return grid_data;  
       } 

       //异步获取用户关联的信息
       function _ajax_get_user_relation_logs(id){
           var _data='{"id":"'+id+'"}';

           var _json;
           $.ajax({  
               async:false,
               type:'post',  
               contentType:"application/x-www-form-urlencoded",
               url : "{:U('Admin/User/ajax_get_user_relation_logs')}",
               data: _data,
               dataType : 'json',
               success  : function(json) {  
                   if(json.code == 0){
                       layer.msg(json.msg);
                       _json=json;
                   }else{
                       layer.msg(json.msg);
                       _json=json;
                   }
               },
               error  : function() {  
                   alert('error');
               }  
           }); 
           return _json;  
       }

       //获取单条信息
       function _ajax_get_row_info(id){
           var _json;
           $.ajax({  
               async:false,
               type:'get',  
               url : "{:U('Admin/User/ajax_get_row_info')}",
               data:{
                 id:id
               },
               dataType : 'json',
               success  : function(json) {  
                   if(json.code == 0){
                       var data=json.data;

                       $('#edit_form .id').val(data.id);
                       $('#edit_form .username').val(data.username);
                       $('#edit_form .company_name').val(data.company_name);
                       $('#edit_form .email').val(data.email);
                       $('#edit_form .phone').val(data.phone);
                       
                       
                       if(data.company_logo){
                           $('#edit_form .company_logo').val(data.company_logo);
                           $('#edit_form .show_img').attr('src', data.company_logo).show();
                       }else{
                           $('#edit_form .company_logo').val('');
                           $('#edit_form .show_img').attr('src', '').hide();
                       }

                       $('#edit_form .gid').val(data.gid);
                       $.each($("#edit_form .gid option"), function(name, value){
                           if($(value).attr('alt')==data.gid){
                               $(value).attr('selected','selected');
                           }else{
                               $(value).removeAttr('selected');
                           }
                       });

                       $('#edit_form .company_introduction').val(data.company_introduction);

                       var str='';
                       if(1==data.status){
                           str+='<input type="radio" name="status" class="status" value="1" title="待审核" checked="checked">';
                           str+='<input type="radio" name="status" class="status" value="-1" title="禁止">';
                           str+='<input type="radio" name="status" class="status" value="2" title="已认证">';
                       }else if(-1==data.status){
                           str+='<input type="radio" name="status" class="status" value="1" title="待审核">';
                           str+='<input type="radio" name="status" class="status" value="-1" title="禁止" checked="checked">';
                           str+='<input type="radio" name="status" class="status" value="2" title="已认证">';
                       }else if(2==data.status){
                           str+='<input type="radio" name="status" class="status" value="1" title="待审核">';
                           str+='<input type="radio" name="status" class="status" value="-1" title="禁止">';
                           str+='<input type="radio" name="status" class="status" value="2" title="已认证" checked="checked">';
                       }
                       $("#edit_form .status_box").html(str);

                       var str='';
                       if(1==data.recommend){
                           str+='<input type="radio" name="recommend" class="recommend" value="1" title="是" checked="checked">';
                           str+='<input type="radio" name="recommend" class="recommend" value="0" title="否">';
                       }else{
                           str+='<input type="radio" name="recommend" class="recommend" value="1" title="是">';
                           str+='<input type="radio" name="recommend" class="recommend" value="0" title="否" checked="checked">';
                       }


                       $("#edit_form .recommend_box").html(str);
                       
                       _json=json;

                       layui.form().render();
                   }else{
                       layer.msg(json.msg);
                   }
               },
               error  : function() {  
                   layer.msg('error');
               }  
           }); 
           return _json;
       }

       //异步编辑信息
       function _ajax_edit(_data){
           var _json;
           $.ajax({  
               async:false,
               type:'post',  
               contentType:"application/x-www-form-urlencoded",
               url : "{:U('Admin/User/ajax_edit')}",
               data: _data,
               dataType : 'json',
               success  : function(json) {  
                   if(json.code == 0){
                        layer.msg(json.msg);
                        var selectID=$("#grid-table").getGridParam("selrow");
                        $("#grid-table").setRowData(selectID, json.data);
                        $("div[aria-describedby='dialog-confirm_edit'] .ui-dialog-titlebar-close").trigger("click");
                   }else{
                        layer.msg(json.msg);
                        _json=json;
                   }
               },
               error  : function() {  
                   alert('error');
               }  
           }); 
           return _json;  
       }

       //异步添加信息
       function _ajax_add(_data){
           var _json;
           $.ajax({  
               async:false,
               type:'post',  
               contentType:"application/x-www-form-urlencoded",
               url : "{:U('Admin/User/ajax_add')}",
               data: _data,
               dataType : 'json',
               success  : function(json) {  
                   if(json.code == 0){
                       layer.msg(json.msg);
                       $("#grid-table").addRowData(1, json.data, "first");
                       $("#add_form .reset").trigger('click');
                       $("div[aria-describedby='dialog-confirm_add'] .ui-dialog-titlebar-close").trigger("click");
                   }else{
                       layer.msg(json.msg);
                       _json=json;
                   }
               },
               error  : function() {  
                   alert('error');
               }  
           }); 
           return _json;  
       }

       //异步添加优惠券
       function _ajax_add_coupon(_data){
           var _json;
           $.ajax({  
               async:false,
               type:'post',  
               contentType:"application/x-www-form-urlencoded",
               url : "{:U('Admin/User/ajax_add_coupon')}",
               data: _data,
               dataType : 'json',
               success  : function(json) {  
                   if(json.code == 0){
                       layer.msg(json.msg);
                       $("#grid-table").addRowData(1, json.data, "first");
                       $("#add_form .reset").trigger('click');
                       $("div[aria-describedby='dialog-confirm_add'] .ui-dialog-titlebar-close").trigger("click");
                   }else{
                       layer.msg(json.msg);
                       _json=json;
                   }
               },
               error  : function() {  
                   alert('error');
               }  
           }); 
           return _json;  
       }

       //异步删除
       function _ajax_del(ids){
           var _RowID='{"ids":"'+ids+'"}';

           var _json;
           $.ajax({  
               type:'post',  
               url : "{:U('Admin/User/ajax_del')}",
               data: _RowID,
               dataType : 'json',
               success  : function(json) {  
                   if(json.code == 0){
                       layer.msg(json.msg);
                       var selectRow = $("#grid-table").jqGrid('getGridParam','selrow');
                       $("#grid-table").delRowData(selectRow);
                   }else{
                       layer.msg(json.msg);
                       _json=json;
                   }
               },
               error  : function() {  
                   layer.msg('error');
               }  
           }); 
       }
    </script>


    <script>
        layui.use('laydate', function(){
            var laydate = layui.laydate;
            var start = {
              istoday: false
              ,choose: function(datas){
                end.min = datas; //开始日选好后，重置结束日的最小日期
                end.start = datas //将结束日的初始值设定为开始日
              }
            };

            var end = {
              istoday: false
              ,choose: function(datas){
                start.max = datas; //结束日选好后，重置开始日的最大日期
              }
            };

            $('.LAY_demorange_s').click(function(){
                start.elem = this;
                laydate(start);
            });

            $('.LAY_demorange_e').click(function(){
                end.elem = this;
                laydate(end);
            });
        });

    </script>
    
    <script>
        function init_editer(edit_type){
            layui.use(['form', 'layedit', 'laydate', 'upload'], function(){
              var form = layui.form()
              ,layer = layui.layer
              ,layedit = layui.layedit
              ,laydate = layui.laydate;


              var arr=edit_type.split('_');
              var form_type=arr[1];

              //上传图片
              layui.upload({
                 url: "{:U('Admin/User/lay_upload_file')}" //上传接口
                 ,elem: '#'+form_type+'_upload_img' //指定原始元素，默认直接查找class="layui-upload-file"
                 ,success: function(res){ //上传成功后的回调
                   if(res.code==0){
                      $('#'+form_type+'_form .company_logo').val(res.data.src);
                      $('#'+form_type+'_form .show_img').show().attr('src', res.data.src);
                   }
                 }
              });
              
              //上传图片接口：注意：layedit.set 一定要放在 build前面，否则配置全局接口将无效
              layedit.set({
                  uploadImage: {
                      url: "{:U('Admin/User/lay_upload_file')}", //接口url
                      type: 'post', //默认post
                  }
              });

              //创建一个编辑器
              var editIndex = layedit.build(edit_type);

              //自定义验证规则
              form.verify({
                title: function(value){
                  if(value.length < 5){
                    return '标题至少得5个字符啊';
                  }
                }
                ,pass: [/(.+){6,12}$/, '密码必须6到12位']
                ,content: function(value){
                  layedit.sync(editIndex);
                }
              });

              //监听提交
              form.on('submit(demo1_add)', function(data){
                var _json=_ajax_add(data.field);
                return false;
              });

              //监听提交
              form.on('submit(demo1_add-coupon)', function(data){
                var _json=_ajax_add_coupon(data.field);
                return false;
              });

              //监听提交
              form.on('submit(demo1_edit)', function(data){
                var _json=_ajax_edit(data.field);
                return false;
              });
            });
        }
    </script>
  </body>
</html>


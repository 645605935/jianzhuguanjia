<include file="Public/header"/>
    <!-- basic styles -->
    <link href="__PUBLIC__/Admin/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome.min.css" />

    <!--[if IE 7]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/font-awesome-ie7.min.css" />
    <![endif]-->

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.custom.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/chosen.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/bootstrap-timepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/daterangepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/colorpicker.css" />
    
    <!-- 模块jqgrid  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/jquery-ui-1.10.3.full.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/datepicker.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ui.jqgrid.css" />
    <!-- 模块jqgrid  end -->

    <!-- fonts -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/assets/css/google_font_css.css">

    <!-- ace styles -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-rtl.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-skins.min.css" />

    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <link rel="stylesheet" href="__PUBLIC__/Admin/jquery-smartMenu/css/smartMenu.css" type="text/css" />
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->

    <link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">
    <link rel="stylesheet" href="__PUBLIC__/Admin/css/my_diy_css.css"  media="all">

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="__PUBLIC__/Admin/assets/css/ace-ie.min.css" />
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->

    <script src="__PUBLIC__/Admin/assets/js/ace-extra.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.min.js"></script>
    <!-- layui.js   -->
    <script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>
    <script src="__PUBLIC__/layer/layer.js"></script>
<script>

  

</script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->



    <!--[if lt IE 9]>

    <script src="__PUBLIC__/Admin/assets/js/html5shiv.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/respond.min.js"></script>

    <![endif]-->

  </head>

  <body>
    <div class="navbar navbar-default" id="navbar">
      <include file="Public/navbar"/>
    </div>

    <div class="main-container" id="main-container">

      <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
      </script>

      <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
          <span class="menu-text"></span>
        </a>

        <!-- 左侧菜单栏 start-->
        <div class="sidebar" id="sidebar">
          <include file="Public/left"/>
        </div>
        
        <!-- 右侧主要内容 start-->
        <div class="main-content" style="overflow: hidden;">
          

          <!-- 右block_1  start -->
          <div class="breadcrumbs" id="breadcrumbs">
            <script type="text/javascript">
              try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
            </script>

            <ul class="breadcrumb">
              <include file="Public/_breadcrumb"/>
            </ul><!-- .breadcrumb -->

            <div class="nav-search" id="nav-search">
              <form class="form-search">
                <span class="input-icon">
                  <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                  <i class="icon-search nav-search-icon"></i>
                </span>
              </form>
            </div><!-- #nav-search -->
          </div>
          <!-- 右block_1  end -->

          <div class="page-content">
            
            <div class="row">
                <style>
                  .layui-form-item .layui-input-inline{width: auto!important;}
                  .layui-form-item{margin-bottom: 0px;}
                  .search_button{position: absolute!important;right: 0px!important;top: 4px!important;}
                  #gbox_grid-table{width: 100%!important;}
                  #gview_grid-table{width: 100%!important;}
                  #gview_grid-table>div{width: 100%!important;}
                  #trv_Modify,#trv_Delete{display: none;}
                </style>

                <!-- 权限设置  start -->
                <div class="row">
                  <include file="Public/role_page_setting"/>
                </div>
                <!-- 权限设置  end -->

                <!-- 搜索  start -->
                <div class="row">
                  <div class="col-xs-12">

                    <form class="layui-form layui-form-pane col-xs-12" action="" method="post">
                       <table class="layui-table" id="search_table">
                          <thead>
                            <tr>
                              <th>搜索</th>
                            </tr> 
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                
                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">生产工单号</label>
                                    <div class="layui-input-inline">
                                      <input type="text" name="orderid" placeholder="全部" value="{$_POST['orderid']}" autocomplete="off" class="layui-input orderid">
                                    </div>
                                  </div>
                                </div>   

                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">时间范围</label>
                                    <div class="layui-input-inline">
                                      <input class="layui-input start" name="start" value="{$_POST['start']}" placeholder="开始时间" id="LAY_demorange_s">
                                    </div>
                                    <div class="layui-input-inline">
                                      <input class="layui-input end" name="end" value="{$_POST['end']}" placeholder="结束时间" id="LAY_demorange_e">
                                    </div>
                                  </div>
                                </div>

                                <div class="layui-inline" style="margin-top: 5px;">
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">零件名称</label>
                                    <div class="layui-input-inline">
                                      <input type="text" name="partname" placeholder="全部" value="{$_POST['partname']}" autocomplete="off" class="layui-input partname">
                                    </div>
                                  </div>
                                </div>   

                              </td>
                            </tr>
                          </tbody>
                          <tfoot>
                            <tr>
                              <td>
                                <button style="float:right;" class="layui-btn search_btn" type="submit" title="search_btn">搜索</button>
                              </td>
                            </tr> 
                          </tfoot>
                        </table>
                    </form>
                    <script>
                        layui.use('laydate', function(){
                          var laydate = layui.laydate;
                          var start = {
                            istoday: false
                            ,choose: function(datas){
                              end.min = datas; //开始日选好后，重置结束日的最小日期
                              end.start = datas //将结束日的初始值设定为开始日
                            }
                          };

                          var end = {
                            istoday: false
                            ,choose: function(datas){
                              start.max = datas; //结束日选好后，重置开始日的最大日期
                            }
                          };

                          document.getElementById('LAY_demorange_s').onclick = function(){
                            start.elem = this;
                            laydate(start);
                          }

                          document.getElementById('LAY_demorange_e').onclick = function(){
                            end.elem = this
                            laydate(end);
                          }
                        });
                    </script>
                  </div>
                </div>
                <!-- 搜索  end -->
            </div>

            <div class="row"> 


                  <div class="col-xs-6">
                      <div class="panel panel-default">
                        <div class="panel-heading">生产记录</div>
                        <div class="panel-body">
                          <table id="grid-table"></table>
                          <div id="grid-pager"></div>
                        </div>
                      </div>
                  </div>

                  <div class="col-xs-6">
                      <div class="panel panel-default">
                        <div class="panel-heading">抽检记录</div>
                        <div class="panel-body">
                          <table id="grid-table-2"></table>
                          <div id="grid-pager-2"></div>
                        </div>
                      </div>
                  </div>


            </div>

            <div class="row"> 

                  

                  <div class="col-xs-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">图列显示</div>
                        <div class="panel-body">
                          <div class="row" id="drag__">
                            <style>
                                  #drag__ ul.tags{ list-style-type: none; margin: 0; padding: 0; margin-bottom: 10px; width: 100%;}
                                  #drag__ ul.tags li{width: 100px;display: block;height: 39px;line-height: 30px;border:0px;}
                                  #drag__ td{border: 1px solid #ccc!important;overflow: hidden;box-sizing: border-box;}

                                  #drag__ table td li{float: left;display: block;width:80%; overflow: hidden;}
                                  #drag__ .tags_box{display: block;height: 100%;width: 100%;position: absolute;left: 0;top: 0;overflow: hidden;color: #F90A0A;}
                                  #drag__ .red_tag{background: url('__PUBLIC__/flag.png') no-repeat right top;background-size: 20px;}

                                  .tags li{display: block;float: left;padding:0px;}
                            </style>
                            <div class="col-sm-12">
                                <form class="layui-form" action="">
                                    <ul class="list-group tags">
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-success">
                                          <input type="checkbox" name="error_1" value="面变形" title="面变形">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-info">
                                          <input type="checkbox" name="error_2" value="开裂" title="开裂">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-warning">
                                          <input type="checkbox" name="error_3" value="掉锌" title="掉锌">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_4" value="缩颈" title="缩颈">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_5" value="划伤" title="划伤">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_6" value="毛刺" title="毛刺">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_7" value="过薄" title="过薄">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_8" value="回弹" title="回弹">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_9" value="滑移线" title="滑移线">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_10" value="少孔" title="少孔">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_11" value="孙变形" title="孙变形">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_12" value="凸包" title="凸包">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_13" value="凹坑" title="凹坑">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_14" value="起皱" title="起皱">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_15" value="冲击线" title="冲击线">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_16" value="包边痕" title="包边痕">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_16" value="凸凹" title="凸凹">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_17" value="硬点" title="硬点">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_18" value="整形痕" title="整形痕">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_19" value="R角不顺" title="R角不顺">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_20" value="压痕" title="压痕">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_21" value="面不平" title="面不平">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_22" value="波浪" title="波浪">
                                      </li>
                                      <li class="ui-state-highlight draggable list-group-item list-group-item-danger">
                                          <input type="checkbox" name="error_23" value="拉伤" title="拉伤">
                                      </li>
                                    </ul>
                                    <input type="hidden" name="location" class="location">
                                    <button class="layui-btn hidden" lay-submit="" id="demo1_errors" lay-filter="demo1_errors">问题清单</button>
                                </form>

                                <a href="javascript:;" class="btn btn-primary add_errors" title="add_errors">保存</a>
                            </div>

                            <div class="col-sm-12">
                                <div id="createtable"></div>
                                <input type="hidden" name="_width" id="_width">
                                <input type="hidden" name="_height" id="_height">
                                <script type="text/javascript">
                                    function CreateTable_initData(FlagMark,X_Count,Y_Count,P_Picture_url, _PartsName, _WorkOrderDetailID, _ID){ 
                                      //清表格
                                      $('#createtable').html('');

                                      var _red_tag_arr=[];
                                      var _red_tag_str=FlagMark;

                                      _red_tag_arr=_red_tag_str.split("YYY");

                                      var _array=[];
                                      var _json_location="";
                                      $.each(_red_tag_arr,function(key,value){　　
                                        _json_location=value.split("TTT");
                                        
                                        var _k=_json_location[0];
                                        var _v=_json_location[1];
                                        var _temp={_k,_v};
                                        _array.push(_temp);
                                      });


                                      // 图片地址
                                      var img_url = P_Picture_url;     //928*530
                                      
                                      // 创建对象
                                      var img = new Image();
                                      
                                      // 改变图片的src
                                      img.src = img_url;

                                      console.log(img_url)
                                      console.log(img.src)
                                      console.log(img.width)
                                      console.log(img.height)

                                      // 加载完成执行
                                      img.onload = function(){
                                          $('#_width').val(img.width);
                                          $('#_height').val(img.height);

                                          var _width=$('#_width').val();
                                          var _height=$('#_height').val();
                                          var rowCount=X_Count;
                                          var cellCount=Y_Count;

                                          console.log(_width);
                                          console.log(_height);
                                          console.log(rowCount);
                                          console.log(cellCount);

                                          var _table_data=_ajax_list_device_3(_PartsName, _WorkOrderDetailID, _ID);

                                          CreateTable(rowCount,cellCount,_width,_height,_table_data,_array,img_url);
                                      };



                                    }

                                

                                    function CreateTable(rowCount,cellCount,_width,_height,_table_data,_red_tag_arr,img_url){ 
                                       var _key_value="[";
                                       $.each(_table_data, function(i, value) {
                                            if(i==_table_data.length-1){
                                              _key_value+=value.Location+":"+value.Num;
                                            }else{
                                              _key_value+=value.Location+":"+value.Num+",";
                                            }
                                       });
                                       _key_value+="]";

                                       console.log(1111111111);
                                       console.log(_key_value);

                                       var table=$("<table cellspacing='1' bordercolor='#990000' cellpadding='1' style=\"background: url('"+img_url+"') no-repeat;background-size: 100% 100%;margin:0 auto;\" width='"+_width+"' height='"+_height+"'>");
                                       table.appendTo($("#createtable"));
                                       for(var i=0;i<rowCount;i++)
                                       {
                                          var tr=$("<tr></tr>");
                                          tr.appendTo(table);
                                          for(var j=0;j<cellCount;j++)
                                          {
                                             var _row=i+1;
                                             var _col=j+1;

                                             var _location=_row+"_"+_col;
                                             var _counts="";
                                             $.each(_table_data, function(i, value) {
                                                  if(_location == value.Location){
                                                    _counts=value.Num;
                                                  }
                                             });

                                             var ___td="<td style=\"border:1px solid white;position:relative;cursor: pointer;\" align='center' width='50' class='"+_row+"_"+_col+"'>";
                                                 ___td+="<div class='tags_box ui-state-default sortable'>";

                                                      var _count=_counts;
                                                      if( 0<_count && _count<5 ){
                                                          var _size=10*1;
                                                          var _harf_size=_size/2;
                                                          ___td+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#428bca;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
                                                      }else if( 5<=_count && _count<10 ){
                                                          var _size=10*1.5;
                                                          var _harf_size=_size/2;
                                                          ___td+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#42b5ca;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
                                                      }else if( 10<=_count && _count<15 ){
                                                          var _size=10*2;
                                                          var _harf_size=_size/2;
                                                          ___td+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#ca42c2;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
                                                      }else if( 15<=_count && _count<20 ){
                                                          var _size=10*2.5;
                                                          var _harf_size=_size/2;
                                                          ___td+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#4252ca;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
                                                      }else if( 20<=_count && _count<25 ){
                                                          var _size=10*3;
                                                          var _harf_size=_size/2;
                                                          ___td+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#ca425f;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
                                                      }

                                                 ___td+="</div>";
                                                 if(_counts){
                                                    ___td+="<span style='position:absolute;bottom:0px;background-color: blue;color: white;display: block;height: 20px;line-height: 20px;min-width: 20px;'>"+_counts+"</span>";
                                                 }
                                                 ___td+="<span class='hidden location' style='position:absolute;right:0px;bottom:0px;background-color: green;color: white;display: block;height: 20px;line-height: 20px;width: auto;'>"+_row+"_"+_col+"</span></td>";

                                             ___td+="";

                                             var td=$(___td);
                                             td.appendTo(tr);
                                          }
                                       }
                                       $("#createtable").append("</table>");

                                       //拖动---zhangtr
                                       $( ".sortable" ).sortable({
                                         revert: true
                                       });
                                       $( ".draggable" ).draggable({
                                         connectToSortable: "td .tags_box",
                                         helper: "clone",
                                         revert: "invalid"
                                       });
                                       $( "ul, li" ).disableSelection();


                                       //渲染小红旗
                                       $.each(_red_tag_arr,function(key,value){　
                                          if(value['_v']==1){
                                            $('#createtable tbody td.'+value['_k']+" div.tags_box").addClass('red_tag');
                                          }　
                                       })
                                    }
                                </script>
                            </div>
                        </div>
                        </div>
                      </div>
                  </div>


                  <div class="col-xs-12">
                      <div class="panel panel-default">
                        <div class="panel-heading" style="position: relative;">
                            问题列表
                            <button class="layui-btn layui-btn-small layui-btn-normal" id="export_list" style="position: absolute;right: 16px;top: 5px;">导出</button>
                        </div>
                        <div class="panel-body">
                          <table id="grid-table-3"></table>
                          <div id="grid-pager-3"></div>
                        </div>
                      </div>
                  </div>

                
            </div><!-- /.row -->
          </div><!-- /.page-content -->

        </div><!-- /.main-content -->
        <!-- 右侧主要内容 end-->

        
        
        <!-- 模板相关设置 -->
        <include file="Public/ace-settings-container"/>

      </div><!-- /.main-container-inner -->



      <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">

        <i class="icon-double-angle-up icon-only bigger-110"></i>

      </a>

    </div><!-- /.main-container -->

    <!-- 底栏版本说明 -->
    <include file="Public/footer"/>

    <!-- basic scripts -->

    <!--[if !IE]> -->



    <!-- <![endif]-->



    <!--[if IE]>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<![endif]-->



    <!--[if !IE]> -->



    <script type="text/javascript">

      window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");

    </script>



    <!-- <![endif]-->



    <!--[if IE]>

<script type="text/javascript">

 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");

</script>

<![endif]-->



    <script type="text/javascript">

      if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");

    </script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/typeahead-bs2.min.js"></script>



    <!-- page specific plugin scripts -->

    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.custom.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/chosen.jquery.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/fuelux/fuelux.spinner.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-timepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/moment.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/date-time/daterangepicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-colorpicker.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.knob.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.autosize.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.inputlimiter.1.3.1.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.maskedinput.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/bootstrap-tag.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/jquery.dataTables.bootstrap.js"></script>
    
    <!-- 模块jqgrid  start -->
    <script src="__PUBLIC__/Admin/assets/js/date-time/bootstrap-datepicker.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/jquery.jqGrid.min.js"></script>
    <!-- <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-en.js"></script> -->
    <script src="__PUBLIC__/Admin/assets/js/jqGrid/i18n/grid.locale-zh.js"></script>
    
    <script src="__PUBLIC__/Admin/assets/js/jquery-ui-1.10.3.full.min.js"></script>
    <script src="__PUBLIC__/Admin/assets/js/jquery.ui.touch-punch.min.js"></script>
    <!-- 模块jqgrid  end -->
  
    <!-- ace scripts -->



    <script src="__PUBLIC__/Admin/assets/js/ace-elements.min.js"></script>

    <script src="__PUBLIC__/Admin/assets/js/ace.min.js"></script>

    

    <!-- inline scripts related to this page -->


    <script type="text/javascript">
      jQuery(function($) {
        var oTable1 = $('#sample-table-2').dataTable( {
        "aoColumns": [
            { "bSortable": false },
            null, null,null, null, null,
          { "bSortable": false }
        ] } );
        
        
        $('table th input:checkbox').on('click' , function(){
          var that = this;
          $(this).closest('table').find('tr > td:first-child input:checkbox')
          .each(function(){
            this.checked = that.checked;
            $(this).closest('tr').toggleClass('selected');
          });
            
        });

        $(".bootbox-regular").on(ace.click_event, function() {
          bootbox.prompt("What is your name?", function(result) {
            if (result === null) {
              //Example.show("Prompt dismissed");
            } else {
              //Example.show("Hi <b>"+result+"</b>");
            }
          });
        });

        $('.date-picker').datepicker({autoclose:true}).next().on(ace.click_event, function(){
          $(this).prev().focus();
        });
        $('input[name=date-range-picker]').daterangepicker().prev().on(ace.click_event, function(){
          $(this).next().focus();
        });


      

      
      
        $('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
        function tooltip_placement(context, source) {
          var $source = $(source);
          var $parent = $source.closest('table')
          var off1 = $parent.offset();
          var w1 = $parent.width();
      
          var off2 = $source.offset();
          var w2 = $source.width();
      
          if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
          return 'left';
        }
      })
    </script>

    <script type="text/javascript">
      //数据列表初使化
      jQuery.support.cors=true;

      //获取列表
      function _ajax_list_device(orderid, partname, start, end){
          var grid_data;
          $.ajax({  
              async:false,
              type:'get',  
              url : 'http://'+api_url+'/Default.ashx?TaskID=5030&orderid='+orderid+'&start='+start+'&end='+end+'&partname='+partname,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code==0){
                      grid_data=json.data;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data;  
      } 


      jQuery(function($) {
        var orderid=$('#search_table .orderid').val();
        var partname=$('#search_table .partname').val();
        var start=$('#search_table .start').val();
        var end=$('#search_table .end').val();

        var grid_data=_ajax_list_device(orderid, partname, start, end);
        jQuery(grid_selector).jqGrid({
          caption: "生产记录",
          data: grid_data,
          datatype: "local",
          height: 430,
          colNames:['WorkOrderDetailID', '生产工单号','生产日期','零件名称', '零件编号' ,'抽检频次','计划生产数量','实际生产数量','计划抽检次数','实际抽检次数','操作'],
          colModel:[
            {name:'WorkOrderDetailID', index:'WorkOrderDetailID', hidden: true},

            {name:'ProductWorkOrderID',index:'ProductWorkOrderID', align : "center"},
            {name:'ProductDate',index:'ProductDate', align : "center"},
            {name:'PartsName',index:'PartsName', align : "center"},
            {name:'PartsNumber',index:'PartsNumber', align : "center"},
            {name:'CheckRate',index:'CheckRate', align : "center"},
            {name:'PlanNum',index:'PlanNum', align : "center"},
            {name:'ActualNum',index:'ActualNum', align : "center"},
            {name:'PlanCheckNum',index:'PlanCheckNum', align : "center"},
            {name:'ActualCheckNum',index:'ActualCheckNum', align : "center"},

            {name:'options',index:'options',align:'center'}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          viewrecords : true,
          rowNum:10,
          rowList:[10,20,30],
          pager : pager_selector,
          altRows: true,
          multiselect: true,
          multiboxonly: true,
      
          loadComplete : function() {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          },

          onSelectRow : function(ids) {
              var _rowData = $(grid_selector).jqGrid('getRowData',ids); 
              var _PartsName=_rowData.PartsName;
              var _WorkOrderDetailID=_rowData.WorkOrderDetailID;

              //抽检记录
              $('#grid-table-2').jqGrid('clearGridData');
              if (ids == null) {
                ids = 0;
                if (jQuery("#grid-table-2").jqGrid('getGridParam','records') > 0) {
                  jQuery("#grid-table-2").jqGrid('setGridParam', {
                        url : "http://"+api_url+"/Default.ashx?TaskID=5031&partsname=" + _PartsName + "&orderid=" + _WorkOrderDetailID,
                        page : 1
                      });
                  jQuery("#grid-table-2").jqGrid('setCaption',"抽检记录: " + _PartsName).trigger('reloadGrid');
                }
              } else {
                jQuery("#grid-table-2").jqGrid('setGridParam', {
                  url : "http://"+api_url+"/Default.ashx?TaskID=5031&partsname=" + _PartsName + "&orderid=" + _WorkOrderDetailID,
                  page : 1
                });
                jQuery("#grid-table-2").jqGrid('setCaption',"抽检记录: " + _PartsName).trigger('reloadGrid');
              }

              //问题列表
              $('#grid-table-3').jqGrid('clearGridData');
              if (ids == null) {
                ids = 0;
                if (jQuery("#grid-table-3").jqGrid('getGridParam','records') > 0) {          
                  jQuery("#grid-table-3").jqGrid('setGridParam', {
                        url : "http://"+api_url+"/Default.ashx?TaskID=5021&partname=" + _PartsName + "&orderid=" + _WorkOrderDetailID,
                        page : 1
                      });
                  jQuery("#grid-table-3").jqGrid('setCaption',"问题列表: " + _PartsName).trigger('reloadGrid');
                }
              } else {
                jQuery("#grid-table-3").jqGrid('setGridParam', {
                  url : "http://"+api_url+"/Default.ashx?TaskID=5021&partname=" + _PartsName + "&orderid=" + _WorkOrderDetailID,
                  page : 1
                });
                jQuery("#grid-table-3").jqGrid('setCaption',"问题列表: " + _PartsName).trigger('reloadGrid');
              }


              //表格渲染
              var grid_data=_ajax_get_img_info(_PartsName,_WorkOrderDetailID);
               console.log(77777777)
               console.log(grid_data);
              if(grid_data){

                    console.log(1000000);
                    console.log(grid_data);

                    var _FlagMark=grid_data[0].FlagMark;
                    var _X_Count=grid_data[0].X_Count;
                    var _Y_Count=grid_data[0].Y_Count;
                    var _P_Picture=grid_data[0].P_Picture;

 
                    console.log(111111111111);
                    console.log(_FlagMark);
                    console.log(_X_Count);
                    console.log(_Y_Count);
                    console.log(_P_Picture);
                    console.log(2222222222);   
 
    
                    //渲染表格开始
                    CreateTable_initData(_FlagMark, _X_Count, _Y_Count, _P_Picture, _PartsName, _WorkOrderDetailID, 0);
                }
          },

          gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接 
              var ids=jQuery(grid_selector).jqGrid('getDataIDs');
              for(var i=0; i<ids.length; i++){
                  var id=ids[i];   

                  var _rowData = $(grid_selector).jqGrid('getRowData',id); 

                  var options="";
                  options+= "<button class='btn btn-primary btn-xs id-btn-dialog2_add' data-workorderid='"+_rowData.WorkOrderDetailID+"' data-productworkorderid='"+_rowData.ProductWorkOrderID+"' data-partname='"+_rowData.PartsName+"'><i class='icon-edit bigger-110'></i>添加</button>";

                  jQuery(grid_selector).jqGrid('setRowData', ids[i], { options: options});
              }


              //②在gridComplete调用合并方法
              var gridName = "grid-table";
              Merger(gridName, 'M_Name');
          },
        });

        // 抽检记录
        jQuery("#grid-table-2").jqGrid({
          datatype: "json",
          colNames:['ID', 'WorkOrderDetailID', '生产工单号', '零件名称', '零件编号', '抽检人', '抽检时间', '检查结果', '操作'],
          colModel:[
            {name:'ID', index:'ID', sorttype:"int", align:"center", hidden: true},
            {name:'WorkOrderDetailID', index:'WorkOrderDetailID', sorttype:"int", align:"center", hidden: true},

            {name:'ProductWorkOrderID',index:'ProductWorkOrderID',align:"center"},
            {name:'PartsName',index:'PartsName',align:"center"},
            {name:'PartsNumber',index:'PartsNumber',align:"center"},
            {name:'CheckPerson',index:'CheckPerson',align:"center"},
            {name:'CheckTime',index:'CheckTime',align:"center"},
            {name:'CheckResult',index:'CheckResult',align:"center"},

            {name:'options',index:'options',align:'center'}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          rowNum:10,
          rowList:[10,100,1000],
          pager : '#grid-pager-2',
          viewrecords : true,
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          height : 430,
          caption : "抽检记录",

          loadComplete : function(data) {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          },

          onSelectRow : function(ids) {

              var _rowData = $('#grid-table-2').jqGrid('getRowData',ids); 

              var _ID=_rowData.ID;
              var _PartsName=_rowData.PartsName;
              var _WorkOrderDetailID=_rowData.WorkOrderDetailID;

              //给按钮添加属性add_errors
              $('.add_errors').attr('data-P_Number', _rowData.PartsNumber);
              $('.add_errors').attr('data-OrderID', _rowData.WorkOrderDetailID);
              $('.add_errors').attr('data-CheckRecordID', _rowData.ID);


              //问题列表
              $('#grid-table-3').jqGrid('clearGridData');
              if (ids == null) {
                ids = 0;
                if (jQuery("#grid-table-3").jqGrid('getGridParam','records') > 0) {          
                  jQuery("#grid-table-3").jqGrid('setGridParam', {
                        url : "http://"+api_url+"/Default.ashx?TaskID=50210&partname=" + _PartsName + "&orderid=" + _WorkOrderDetailID+ "&checkrecordid=" + _ID,
                        page : 1
                      });
                  jQuery("#grid-table-3").jqGrid('setCaption',"问题列表: " + _PartsName).trigger('reloadGrid');
                }
              } else {
                jQuery("#grid-table-3").jqGrid('setGridParam', {
                  url : "http://"+api_url+"/Default.ashx?TaskID=50210&partname=" + _PartsName + "&orderid=" + _WorkOrderDetailID+ "&checkrecordid=" + _ID,
                  page : 1
                });
                jQuery("#grid-table-3").jqGrid('setCaption',"问题列表: " + _PartsName).trigger('reloadGrid');
              }


              //表格渲染
              var grid_data=_ajax_get_img_info(_PartsName,_WorkOrderDetailID);
              if(grid_data){

                console.log(1000000);
              console.log(grid_data);
                      var _FlagMark=grid_data[0].FlagMark;
                      var _X_Count=grid_data[0].X_Count;
                      var _Y_Count=grid_data[0].Y_Count;
                      var _P_Picture=grid_data[0].P_Picture;

                      //渲染表格开始
                      CreateTable_initData(_FlagMark, _X_Count, _Y_Count, _P_Picture, _PartsName, _WorkOrderDetailID, _ID);
                }
          },

          gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
              var ids=jQuery("#grid-table-2").jqGrid('getDataIDs');
              for(var i=0; i<ids.length; i++){
                  var id=ids[i];   
                  var _rowData = $("#grid-table-2").jqGrid('getRowData',id); 

                  var options = "";
                      options+= "<button style='width:60px;margin-bottom:5px;' class='btn btn-primary btn-xs id-btn-dialog2_edit_2' data-ID='"+_rowData.ID+"' data-checkresult='"+_rowData.CheckResult+"'><i class='icon-edit bigger-110'></i>修改</button><br>";
                      options+= "<button style='width:60px;' class='btn btn-danger btn-xs id-btn-dialog2_del_2' data-ID='"+_rowData.ID+"'><i class='icon-trash bigger-110'></i>删除</button>";   
                  jQuery("#grid-table-2").jqGrid('setRowData', ids[i], { options: options});
              }
          },

        }).navGrid('#grid-pager-2', {
          add : false,
          edit : false,
          del : false
        });

        //问题列表
        jQuery("#grid-table-3").jqGrid({
          datatype: "json",
          colNames:['StoppageID', '坐标', '描述', '日期','操作员','操作'],
          colModel:[
            {name:'StoppageID',index:'StoppageID',  sorttype:"int",align : "center", hidden: true},

            {name:'Location',index:'Location', align : "center"},
            {name:'Describe',index:'Describe', align : "center"},
            {name:'CheckTime',index:'CheckTime', align : "center"},
            {name:'CheckUser',index:'CheckUser', align : "center"},

            {name:'options',index:'options',align:'center',width:'200'}
          ], 
          rownumbers:true,
          rownumWidth:50,//设置行号列宽度
          rowNum:1000,
          rowList:[10,100,1000],
          // pager : '#grid-pager-3',
          viewrecords : true,
          autowidth:true,
          shrinkToFit:true,//ture，则按比例初始化列宽度。如果为false，则列宽度使用colModel指定的宽度
          height : 'auto',
          caption : "问题列表",

          loadComplete : function(data) {
            var table = this;
            setTimeout(function(){
              updatePagerIcons(table);
            }, 0);
          },

          gridComplete:function(){  //在此事件中循环为每一行添加修改和删除链接
              var ids=jQuery("#grid-table-3").jqGrid('getDataIDs');

              var no_data=0;
              for(var i=0; i<ids.length; i++){
                  var id=ids[i];   
                  var _rowData = $("#grid-table-3").jqGrid('getRowData',id);

                  if(_rowData.StoppageID==0){
                      no_data++;
                      // $("#grid-table-3").setRowData(id, null, {display: 'none'});
                  }

                  var options="";
                  options += "<button class='btn btn-primary btn-xs id-btn-dialog2_edit' data-Describe='"+_rowData.Describe+"' data-id='"+_rowData.StoppageID+"' style='margin-right:5px;'><i class='icon-edit bigger-110'></i>修改</button>";
                  options += "<button class='btn btn-danger btn-xs id-btn-dialog2_del' data-id='"+_rowData.StoppageID+"'><i class='icon-trash bigger-110'></i>删除</button>";   

                  jQuery("#grid-table-3").jqGrid('setRowData', ids[i], { options: options});
              }

              if(no_data>0){
                  $('#grid-table-3').jqGrid('clearGridData');
              }
          },

        }).navGrid('#grid-pager-3', {
          add : false,
          edit : false,
          del : false
        });

        jQuery('#grid-table-3').closest(".ui-jqgrid-bdiv").css({ "overflow-x" : "hidden" });//去除jqgrid横向滚动条


        //公共调用方法
        function Merger(gridName, CellName) {
            //得到显示到界面的id集合
            var mya = $("#" + gridName + "").getDataIDs();
            //当前显示多少条
            var length = mya.length;
            for (var i = 0; i < length; i++) {
                //从上到下获取一条信息
                var before = $("#" + gridName + "").jqGrid('getRowData', mya[i]);
                //定义合并行数
                var rowSpanTaxCount = 1;
                for (j = i + 1; j <= length; j++) {
                    //和上边的信息对比 如果值一样就合并行数+1 然后设置rowspan 让当前单元格隐藏
                    var end = $("#" + gridName + "").jqGrid('getRowData', mya[j]);
                    if (before[CellName] == end[CellName]) {
                        rowSpanTaxCount++;
                        $("#" + gridName + "").setCell(mya[j], CellName, '', { display: 'none' });
                    } else {
                        rowSpanTaxCount = 1;
                        break;
                    }
                    $("#" + CellName + "" + mya[i] + "").attr("rowspan", rowSpanTaxCount);
                }
            }
        }
      

      
      
  
        //replace icons with FontAwesome icons like above   //更新分页图标  
        function updatePagerIcons(table) {
          var replacement = 
          {
            'ui-icon-seek-first' : 'icon-double-angle-left bigger-140',
            'ui-icon-seek-prev' : 'icon-angle-left bigger-140',
            'ui-icon-seek-next' : 'icon-angle-right bigger-140',
            'ui-icon-seek-end' : 'icon-double-angle-right bigger-140'
          };
          $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function(){
            var icon = $(this);
            var $class = $.trim(icon.attr('class').replace('ui-icon', ''));
            
            if($class in replacement) icon.attr('class', 'ui-icon '+replacement[$class]);
          })
        }

        //初使化按钮操作权限
        var page="{$page}";
        _init_button_operate(page);
      
      });
    </script>
    
    <!-- 模板引擎doT.js    start -->
    <script id="j-tmpl_lingjian" type="text/template">
        {{ if(it.code==0){ }}

                {{ for (var i = 0, l = it.data.length; i < l; i++) { }}

                      <tr>
                        <td class="center">
                            <a href="#">序号</a>
                        </td>
                        <td class="center">
                            <a href="#">生产工单号</a>
                        </td>
                        <td class="center">
                            <a href="#">零件名称</a>
                        </td>
                        <td class="center">
                            <a href="#">零件编号</a>
                        </td>
                        <td class="center">
                            <a href="#">抽检人</a>
                        </td>
                        <td class="center">
                            <a href="#">抽检时间</a>
                        </td>
                        <td class="center">
                            检查结果
                        </td>
                      </tr>

                {{ } }}

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}
    </script>

     <!-- 模板引擎doT.js    start -->
    <script id="j-tmpl_lingjian_dialog" type="text/template">
        {{ if(it.code==0){ }}

                {{ for (var i = 0, l = it.data.length; i < l; i++) { }}

                      <tr data-id="{{=it.data[i].RowID}}">
                        <td class="center">
                            <a href="#">{{=it.data[i].P_Name}}</a>
                        </td>
                      </tr>

                {{ } }}

        {{ }else{ }}

                <h2>暂无数据</h2>

        {{ } }}
    </script>


    
    <script src="__PUBLIC__/Admin/doT-master/doT.js"></script>
    <script type="text/javascript">
        $(function(){
            // var obj = {
            //     success: true,
            //     data:[
            //         {id:'9991',title:'小红',time:'2013-5-12',username:'zhangtr'},
            //         {id:'9992',title:'小明',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9993',title:'张三',time:'2016-1-1',username:'sgaiying'},
            //         {id:'9992',title:'李四',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9993',title:'马六',time:'2016-1-1',username:'sgaiying'},
            //         {id:'9992',title:'二高',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9993',title:'李四',time:'2016-1-1',username:'sgaiying'},
            //         {id:'9992',title:'小白',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9993',title:'小黑',time:'2016-1-1',username:'sgaiying'},
            //         {id:'9992',title:'马六',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9993',title:'小花',time:'2016-1-1',username:'sgaiying'},
            //         {id:'9992',title:'李四',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9992',title:'瑞瑞',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9993',title:'二狗',time:'2016-1-1',username:'sgaiying'},
            //         {id:'9992',title:'小明',time:'2016-5-12',username:'zjianhui'},
            //         {id:'9993',title:'平平',time:'2016-1-1',username:'sgaiying'},
            //         {id:'9994',title:'林强',time:'2016-12-12',username:'sun'},
            //         {id:'9995',title:'师小蛋',time:'2016-11-1',username:'money'}
            //     ]
            // }
            // var tmpl = document.getElementById('j-tmpl').innerHTML;
            // var doTtmpl = doT.template(tmpl);
            // var doT_Str=doTtmpl(obj);
            // $('#sample-table-1 ._list_box').html(doT_Str);

            // Fn_Init_smartMenu();
            
            // $('.pagination').click(function(){
            //     var obj = {
            //         success: true,
            //         data:[
            //             {id:'9991',title:'张腾瑞11111',time:'2013-25-12',username:'zhangtr'}
            //         ]
            //     }
            //     var tmpl = document.getElementById('j-tmpl').innerHTML;
            //     var doTtmpl = doT.template(tmpl);
            //     var doT_Str=doTtmpl(obj);
            //     $('#sample-table-1 ._list_box').html(doT_Str);

            //     Fn_Init_smartMenu();
            // });
            
            //smartMenu右键自定义上下文菜单插件初使化
            Fn_Init_smartMenu();
            
            $('.ui-state-default.ui-jqgrid-hdiv').click(function(){
                Fn_Init_smartMenu();
            });

            $('.ui-jqgrid-bdiv').click(function(){
                Fn_Init_smartMenu();
            });

            
        });
    </script>
    <!-- 模板引擎doT.js    end -->
    



    <!-- jQuery smartMenu右键自定义上下文菜单插件  start -->
    <script type="text/javascript" src="__PUBLIC__/Admin/jquery-smartMenu/js/jquery-smartMenu.js"></script>
    <script>
        function Fn_Init_smartMenu(){
            var chkSingle = $("th input"), chkGroup = $("td input");
            var funTrStyle = function() {
              chkGroup.each(function() {
                if ($(this).attr("checked")) {
                  $(this).parents("tr").addClass("bg"); 
                } else {
                  $(this).parents("tr").removeClass("bg");  
                }
              });
            }, funTrGet = function() {
              return  $("td input:checked").parents("tr");
            };

            chkSingle.bind("click", function() {
              if ($(this).attr("checked")) {
                chkGroup.attr("checked", "checked");
              } else {
                chkGroup.attr("checked", "");
              }
              funTrStyle(); 
            });

            chkGroup.bind("click", funTrStyle);
            funTrStyle();

            //自定义右键上下文
            var objDelete = {
              text: "删除",
              func: function() {
                  $('#del_grid-table').trigger('click');
              } 
            }, objShow = {
              text: "查看",
              func: function() {
                  $('#view_grid-table').trigger('click');
              } 
            }, objEdit = {
              text: "编辑",
              func: function() {
                  $('#edit_grid-table').trigger('click');
              }
            }, objUnRead = {}, objSend = {};

            var mailMenuData = [
              [objDelete, objShow]
            ];

            $("#grid-table>tbody>tr").smartMenu(mailMenuData, {
              name: "mail",
              beforeShow: function() {    
                //根据选中的是否是已读显示不同的上下文菜单
                $(this).find("input").attr("checked", "checked"); 
                funTrStyle();

                //动态数据，及时清除
                $.smartMenu.remove();

                //确定显示数据 - 主要是已读与未读
                var numTrBold = 0, numTrNormal = 0, eleTr = funTrGet();
                eleTr.each(function() {
                  if ($(this).css("font-weight") === "700") {
                    numTrBold++; 
                  } 
                  if ($(this).css("font-weight") === "400") {
                    numTrNormal++;  
                  }
                });

                if (eleTr.size() === numTrBold) {
                  //全是粗体  
                  mailMenuData[1] = [objEdit];
                } else if (eleTr.size() === numTrNormal) {
                  //全是正常
                  mailMenuData[1] = [objEdit];
                } else {
                  //混杂
                  mailMenuData[1] = [objEdit];
                }
              }
            });
        }
    </script>
    <!-- jQuery smartMenu右键自定义上下文菜单插件  end -->
<!-- ============================= -->
    <!-- 添加模具 start-->
    <div id="dialog-confirm" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">
            
            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">模具名称</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="模具名称" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item"> 
                          <label class="layui-form-label">制作厂家</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="制作厂家" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">生产线</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="生产线" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">负责人</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="负责人" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-3">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">状态</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="状态" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <a href="javascript:;" class="layui-btn add_row">
                        <i class="layui-icon">&#xe608;</i> 添加
                      </a>
                    </td>
                  </tr>
                  
                </tbody>
            </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 确认弹框 start-->
    <div id="dialog-confirm_add" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="">
            
            <table class="table table-striped table-bordered table-hover" id="add_cjjl_form">
                <tbody>
                  <tr>
                    <td colspan="2" class="center">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">检查结果</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="checkresult" class="checkresult" value="合格" title="合格" checked="">
                                <input type="radio" name="checkresult" class="checkresult" value="不合格" title="不合格">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <input type="hidden" name="workorderid" class='workorderid'>
                      <input type="hidden" name="productworkorderid" class='productworkorderid'>
                      <input type="hidden" name="partname" class='partname'>
                      <button class="layui-btn" lay-submit="" lay-filter="demo1_add_cjjl">确认</button>
                    </td>
                  </tr>
                </tfoot>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 确认弹框 start-->
    <div id="dialog-confirm_edit_2" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="">
            
            <table class="table table-striped table-bordered table-hover" id="edit_2_form">
                <tbody>
                  <tr>
                    <td colspan="2" class="center">

                        <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label">检查结果</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="checkresult" class="checkresult" value="合格" title="合格" checked="">
                                <input type="radio" name="checkresult" class="checkresult" value="不合格" title="不合格">
                            </div>
                          </div>
                        </div>

                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <input type="hidden" name="ID" class='ID'>
                      <button class="layui-btn" lay-submit="" lay-filter="demo1_edit_2">确认</button>
                    </td>
                  </tr>
                </tfoot>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <!-- 添加模具工序 start-->
    <div id="dialog-confirm_gongxu" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">
            
            <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                <tbody id="liaoliao_box">
                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">模具编号</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="模具编号" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">工序名称</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="工序名称" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-2">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">长</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="长" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">宽</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="宽" autocomplete="off" class="layui-input id-btn-dialog2_bl_info item-3">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">高</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="高" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">上模重量</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="高" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">高</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="高" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">上模重量</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="上模重量" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

  

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">下模重量</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="下模重量" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">下模高度</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="下模高度" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
 

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">装模高度</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="装模高度" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">闭合高度</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="闭合高度" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">压边力</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="压边力" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">成型力</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="成型力" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
   

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">保养周期（根据次数）</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="保养周期（根据次数）" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">保养周期（根据时间）</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="保养周期（根据时间）" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td class="center">
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">制造厂家</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="制造厂家" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label">负责人</label>
                          <div class="layui-input-inline">
                            <input type="text" name="keyword" lay-verify="required" placeholder="负责人" autocomplete="off" class="layui-input item-1">
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <a href="javascript:;" class="layui-btn add_row">
                        <i class="layui-icon">&#xe608;</i> 添加
                      </a>
                    </td>
                  </tr>
                  
                </tbody>
            </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 选择零件 start-->
    <div id="dialog-confirm_select_lingjian" class="hide">
       <div class="row">
              <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                  <tbody id="lingjian_box">
                    <tr>
                      <td class="center">
                          <a class="layui-btn layui-btn-normal">合格</a>
                      </td>
                      <td class="center">
                          <a class="layui-btn layui-btn-warm">不合格</a>
                      </td>
                    </tr>
                  </tbody>
              </table>
        </div>
    </div><!-- #dialog-confirm -->
    
    <!-- 选择车型 start-->
    <div id="dialog-confirm_select_chexing" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="{:U('Admin/Course/index')}">
              <table id="sample-table-1" class="table table-striped table-bordered table-hover">
                  <tbody id="chexing_box">
                    <tr>
                      <td class="center">
                          3213213131
                      </td>
                    </tr>
                  </tbody>
                </table>
           </form>
        </div>
    </div><!-- #dialog-confirm -->


    <!-- 确认弹框 start-->
    <div id="dialog-confirm_edit" class="hide">
       <div class="row">
           <form class="layui-form layui-form-pane col-xs-12" action="">
            
            <table class="table table-striped table-bordered table-hover" id="error_edit_form">
                <tbody>
                  <tr>
                    <td colspan="2" class="center">
                        <input class="layui-input StoppageID" type="hidden" name="StoppageID">
                        <textarea name="Describe" placeholder="请输入内容" class="layui-textarea Describe"></textarea>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="2" style="text-align:right;">
                      <button class="layui-btn" lay-submit="" lay-filter="demo1_error_edit">确认</button>
                    </td>
                  </tr>
                </tfoot>
              </table>

           </form>
        </div>
    </div><!-- #dialog-confirm -->

    <script type="text/javascript">

      jQuery(function($) {
          jQuery.support.cors=true;

          $('body').on('click','#createtable td',function(){
              $( ".location" ).val($(this).attr('class'));
              $( "#demo1_errors" ).trigger('click');

              //重置问题的选择状态
              $('#drag__ .tags li input').removeAttr('checked');
              layui.form().render();

          });


          //添加模具
          $( ".id-btn-dialog2" ).on('click', function(e) {
            e.preventDefault();

            $( "#dialog-confirm" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              title_html: true
            });

            $("div[aria-describedby='dialog-confirm'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加模具：</h4></div>");
          });

          //添加模具工序
          $( ".id-btn-dialog2_gongxu" ).on('click', function(e) {
            e.preventDefault();

            $( "#dialog-confirm_gongxu" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              title_html: true
            });

            $("div[aria-describedby='dialog-confirm_gongxu'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加模具工序：</h4></div>");
          });

          //选择 －－－  零件出现弹框
          $( ".id-btn-dialog2_select_lingjian" ).on('click', function(e) {
            e.preventDefault();

            $( "#dialog-confirm_select_lingjian" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              title_html: true,
              buttons: [
                {
                  html: "<i class='icon-remove bigger-110'></i>&nbsp; 取消",
                  "class" : "btn btn-xs",
                  click: function() {
                    $( this ).dialog( "close" );
                  }
                }
              ]
            });

            $("div[aria-describedby='dialog-confirm_select_lingjian'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 新建：</h4></div>");
          });

          //选择 －－－  车型出现弹框
          $( ".id-btn-dialog2_select_chexing" ).on('click', function(e) {
            e.preventDefault();

            _ajax_get_chexing_dialog_list();

            $( "#dialog-confirm_select_chexing" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:400,
              height:500,
              title_html: true,
              buttons: [
                {
                  html: "<i class='icon-remove bigger-110'></i>&nbsp; 取消",
                  "class" : "btn btn-xs",
                  click: function() {
                    $( this ).dialog( "close" );
                  }
                }
              ]
            });

            $("div[aria-describedby='dialog-confirm_select_chexing'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 选择车型：</h4></div>");
          });

          //修改缺陷记录
          $( "body" ).on('click',  '.id-btn-dialog2_edit', function(e) {
            e.preventDefault();

            var id=$(this).attr('data-id');
            var remark=$(this).attr('data-Describe');
            $('#error_edit_form .StoppageID').val(id);
            $('#error_edit_form .Describe').val(remark);

            $( "#dialog-confirm_edit" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:800,
              title_html: true,
            });

            $("div[aria-describedby='dialog-confirm_edit'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 修改缺陷记录：</h4></div>");
          });

          //删除缺陷记录
          $( "body" ).on('click',  '.id-btn-dialog2_del', function(e) {
            e.preventDefault();
            var id=$(this).attr('data-id');

            if(confirm("确定要删除选中项？")){
                var _json=_ajax_error_del(id);

                if(_json.code==0){
                    var sel_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
                    $('#grid-table-2 tr#'+sel_id).trigger('click');
                }
            }
            
          });


          //删除缺陷记录
          $( "body" ).on('click',  '.id-btn-dialog2_del_2', function(e) {
            e.preventDefault();
            var id=$(this).attr('data-id');

            if(confirm("确定要删除选中项？")){
                var _json=_ajax_error_del_2(id);

                if(_json.code==0){
                    var sel_id = $('#grid-table').jqGrid('getGridParam', 'selrow');
                    $('#grid-table tr#'+sel_id).trigger('click');
                }
            }
            
          });

        
          //点击右侧零件里面的tr删除一条
          $( "body" ).on('click','#_lingjian_list tr .del_lingjian', function() {
              var _mould_id=$('#right_lingjian_btn').attr('data-mould-id');
              var _part_id=$(this).attr('data-id');

              var json=_ajax_del_lingjian_of_mould_relation(_mould_id,_part_id);

              if(json.code==0){
                  $(this).parents('tr').remove();
              }
          });


          //添加抽检记录
          $( ".id-btn-dialog2_add" ).on('click', function(e) {
            e.preventDefault();

            var workorderid=$(this).attr('data-workorderid');
            var productworkorderid=$(this).attr('data-productworkorderid');
            var partname=$(this).attr('data-partname');


            $('#add_cjjl_form .workorderid').val(workorderid);
            $('#add_cjjl_form .productworkorderid').val(productworkorderid);
            $('#add_cjjl_form .partname').val(partname);


            $( "#dialog-confirm_add" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:500,
              height:300,
              title_html: true,
            });

            $("div[aria-describedby='dialog-confirm_add'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 添加抽检记录：</h4></div>");

            layui.form().render();
          });

          //修改抽检记录
          $( "body" ).on('click', '.id-btn-dialog2_edit_2', function(e) {
            e.preventDefault();

            //获取
            var sel_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
            var _rowData = $('#grid-table-2').jqGrid('getRowData',sel_id); 
            var CheckResult=_rowData.CheckResult;
            $(this).attr('data-checkresult',CheckResult);

            var ID=$(this).attr('data-ID');
            $('#edit_2_form .ID').val(ID);

            $(":radio[name='checkresult'][value='" + CheckResult + "']").prop("checked", "checked");

            layui.form().render();
            $( "#dialog-confirm_edit_2" ).removeClass('hide').dialog({
              resizable: false,
              modal: true,
              title: "",
              width:500,
              height:300,
              title_html: true,
            });

            $("div[aria-describedby='dialog-confirm_edit_2'] div span.ui-dialog-title").html("<div class='widget-header'><h4 class='smaller'><i class='icon-warning-sign red'></i> 修改抽检记录：</h4></div>");
            
          });


          //肿存缺陷记录
          $( "body" ).on('click','.add_errors',function() {
              var _P_Number=$(this).attr('data-P_Number');
              var _OrderID=$(this).attr('data-OrderID');
              var _CheckRecordID=$(this).attr('data-CheckRecordID');
              var _CheckUser=login_user;


              if( _P_Number && _OrderID && _CheckRecordID && _CheckUser ){
                  var _str='{"data":[';
                  $.each($('.tags_box li'),function(name,value){　
                      var _Location=$(value).attr('data-location');
                      var _Describe=$(value).html();
                      if($('.tags_box li').length-1==name){
                          _str+='{"Location":"'+_Location+'","Describe":"'+_Describe+'","P_Number":"'+_P_Number+'","OrderID":"'+_OrderID+'","CheckRecordID":"'+_CheckRecordID+'","CheckUser":"'+_CheckUser+'"}';
                      }else{
                          _str+='{"Location":"'+_Location+'","Describe":"'+_Describe+'","P_Number":"'+_P_Number+'","OrderID":"'+_OrderID+'","CheckRecordID":"'+_CheckRecordID+'","CheckUser":"'+_CheckUser+'"},';
                      }
                  });
                  _str+=']}';

                  _ajax_add_errors(_str);
              }else{
                  layer.msg('请选择抽检记录');
              }
          });


          //导出问题列表
          $('#export_list').click(function(){
              var sel_id = $(grid_selector).jqGrid('getGridParam', 'selrow');
              var _rowData = $(grid_selector).jqGrid('getRowData',sel_id); 
              var _PartsName=_rowData.PartsName;
              var _WorkOrderDetailID=_rowData.WorkOrderDetailID;

              if(_PartsName&&_WorkOrderDetailID){
                  $.ajax({  
                      async:false,
                      type:'get',  
                      contentType:"application/x-www-form-urlencoded",
                      url : 'http://'+api_url+'/Default.ashx?TaskID=6001&partname='+_PartsName+'&orderid='+_WorkOrderDetailID,
                      dataType : 'json',
                      success  : function(json) { 
                          if(json.code==0){
                              var download_url='http://'+api_url+'/'+json.data;
                              // console.log(download_url);
                              window.location.href=download_url;
                          }else{
                              layer.msg(json.msg);
                          }
                      },
                      error  : function(json) {  
                          layer.msg(json.msg);
                      }  
                  });  
              }
          });


          $('#createtable').on('mouseenter','.tags_box',function(){
              $(this).parent('td').find('.location').removeClass('hidden');
          }); 
          $('#createtable').on('mouseout','.tags_box',function(){
              $(this).parent('td').find('.location').addClass('hidden');
          });
      });

      //
      function _ajax_add_errors(_data){
          var _json;
          $.ajax({  
              async:false,
              type:'post',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5022',
              data: _data,
              dataType : 'json',
              success  : function(json) {  
                  console.log(json); 
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;

                      var sel_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
                      $('#grid-table-2 tr#'+sel_id).trigger('click');

                      
                      // var sel_id = $('#grid-table-2').jqGrid('getGridParam', 'selrow');
                      // var _rowData = $('#grid-table-2').jqGrid('getRowData',sel_id); 

                      // var _ID=_rowData.ID;
                      // var _PartsName=_rowData.PartsName;
                      // var _WorkOrderDetailID=_rowData.WorkOrderDetailID;

                      
                      // jQuery("#grid-table-3").jqGrid('setGridParam', {
                      //   url : "http://"+api_url+"/Default.ashx?TaskID=50210&partname=" + _PartsName + "&orderid=" + _WorkOrderDetailID+ "&checkrecordid=" + _ID,
                      //   page : 1
                      // });
                      // jQuery("#grid-table-3").jqGrid('setCaption',"问题列表: " + _PartsName).trigger('reloadGrid');


                      // window.location.reload();
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;  
      }


      //异步请求____零件
      function _ajax_get_right_lingjian_list(_id){
          var _data={"MouldID":_id};
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3027',
              data: _data,
              dataType : 'json',
              success  : function(json) {
                  console.log('11111111111111111111111');  
                  console.log(json);  
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_lingjian').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#_lingjian_list').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {  
                  alert('error');
              }  
          }); 
      }

      //异步请求____车型
      function _ajax_get_right_chexing_list(_id){
          var _data={"MouldID":_id};
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3017',
              data: _data,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_chexing').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#_chexing_list').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {  
                  alert('error');
              }  
          }); 
      }

      //异步请求所有零件
      function _ajax_get_lingjian_dialog_list(){
          $.ajax({  
              async:false,
              type:'post',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3021',
              dataType : 'json',
              success  : function(json) {  
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_lingjian_dialog').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#lingjian_box').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {  
                  alert('error');
              }  
          }); 
      }

      //异步请求所有车型
      function _ajax_get_chexing_dialog_list(){
          $.ajax({  
              async:false,
              type:'post',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=3011',
              dataType : 'json',
              success  : function(json) {  
                  if(json.code == 0){
                      var obj = json;
                      var tmpl = document.getElementById('j-tmpl_chexing_dialog').innerHTML;
                      var doTtmpl = doT.template(tmpl);
                      var doT_Str=doTtmpl(obj);
                      $('#chexing_box').html(doT_Str);
                  }else{
                      alert(json.msg);
                  }
              },
              error  : function() {  
                  alert('error');
              }  
          }); 
      }

      //
      function _ajax_error_edit(data){
        var _data=data.field;

        var StoppageID=_data.StoppageID;
        var Describe=_data.Describe;

        var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5023&id='+StoppageID+'&describe='+Describe,
              dataType : 'json',
              success  : function(json) {  
                  console.log(json); 
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;  
      }

      //
      function _ajax_error_del(id){

          var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5024&id='+id,
              dataType : 'json',
              success  : function(json) {  
                  console.log(json); 
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;  
      }

      function _ajax_error_del_2(id){

          var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5034&id='+id,
              dataType : 'json',
              success  : function(json) {  
                  console.log(json); 
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;  
      }

      //异步给模具添加零件
      function _ajax_add_lingjian_for_mould(_mould_id,_part_id){

          var _data={"MouldID":_mould_id,"PartID":_part_id};

          var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=2018',
              data: _data,
              dataType : 'json',
              success  : function(json) {  
                  if(json.code == 0){
                      _json=json;
                  }else{
                      _json=json;
                  }
              },
              error  : function() {  
                  alert('error');
              }  
          }); 

          return _json;
      }

      //异步添加抽检记录
      function _ajax_add_cjjl(data){
        var _data=data.field;

        var workorderid=_data.workorderid;
        var productworkorderid=_data.productworkorderid;
        var partname=_data.partname;
        var checkresult=_data.checkresult;
        var checkperson=login_user;

        var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5032&workorderid='+workorderid+'&productworkorderid='+productworkorderid+'&partname='+partname+'&checkresult='+checkresult+'&checkperson='+checkperson,
              dataType : 'json',
              success  : function(json) {  
                  console.log(json); 
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;
                  }else{
                      layer.msg(json.msg);
                      _json=json;
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;  
      }

      //异步修改抽检记录
      function _ajax_edit_2(data){
        var _data=data.field;

        var ID=_data.ID;
        var checkresult=_data.checkresult;

        var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5033&ID='+ID+'&checkresult='+checkresult,
              dataType : 'json',
              success  : function(json) {  
                  console.log(json); 
                  if(json.code == 0){
                      layer.msg(json.msg);
                      _json=json;
                  }else{
                      layer.msg(json.msg);
                      _json=json;
                  }
              },
              error  : function() {  
                  layer.msg('error');
              }  
          }); 
          return _json;  
      }

      //异步删除模具的零件的对应关系
      function _ajax_del_lingjian_of_mould_relation(_mould_id,_part_id){

          var _data={"MouldID":_mould_id,"PartID":_part_id};

          var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=2019',
              data: _data,
              dataType : 'json',
              success  : function(json) {  
                console.log(json);
                  if(json.code == 0){
                      _json=json;
                  }else{
                      _json=json;
                  }
              },
              error  : function() {  
                  alert('error');
              }  
          }); 

          return _json;
      }

      //异步删除模具的车型的对应关系
      function _ajax_del_chexing_of_mould_relation(_mould_id,_car_id){

          var _data={"MouldID":_mould_id,"CarID":_car_id};

          var _json;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=2112',
              data: _data,
              dataType : 'json',
              success  : function(json) {  
                console.log(json);
                  if(json.code == 0){
                      _json=json;
                  }else{
                      _json=json;
                  }
              },
              error  : function() {  
                  alert('error');
              }  
          }); 

          return _json;
      }


      //获取渲染图片所需要的信息
      function _ajax_get_img_info(_partname,_order_id){
          var grid_data;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : 'http://'+api_url+'/Default.ashx?TaskID=5021',
              data: {partname:_partname, orderid:_order_id},
              dataType : 'json',
              success  : function(json) { 

                  if(json){
                      grid_data=json;
                  }else{
                      layer.msg(json.msg);
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data;  
      } 

      //获取图片上的问题次数相关信息
      function _ajax_list_device_3(_partname,_order_id,_ID){
          if(_ID){
              var _URL='http://'+api_url+'/Default.ashx?TaskID=50212&partname='+_partname+'&orderid='+_order_id+'&checkrecordid='+_ID;
          }else{
              var _URL='http://'+api_url+'/Default.ashx?TaskID=50211&partname='+_partname+'&orderid='+_order_id;
          }
          

          var grid_data_3;
          $.ajax({  
              async:false,
              type:'get',  
              contentType:"application/x-www-form-urlencoded",
              url : _URL,
              dataType : 'json',
              success  : function(json) {  
                console.log(111111112);
                console.log(json);

                console.log(8888888888888888889);
                  if(json.code==0){
                      grid_data_3=json.data;
                  }else{
                      grid_data_3=json.data;
                  }
              },
              error  : function(json) {  
                  layer.msg(json.msg);
              }  
          });  
          return grid_data_3;  
      } 
    </script>

    <script>
        layui.use(['form', 'laydate'], function(){
          var form = layui.form()
          ,layer = layui.layer
          ,layedit = layui.layedit
          ,laydate = layui.laydate;

          //自定义验证规则
          form.verify({
            title: function(value){
              if(value.length < 5){
                return '标题至少得5个字符啊';
              }
            }
            ,pass: [/(.+){6,12}$/, '密码必须6到12位']
            ,content: function(value){
              layedit.sync(editIndex);
            }
          });

          //监听提交
          form.on('submit(demo1_errors)', function(data){
            console.log(data.field);
            var location=$('.location').val();

            var _str="";
            var _count=0;
            $.each(data.field, function(name,value){　　
                if(name!='location'){
                    _str+="<li style='display:none;' data-location='"+location+"'>"+value+"</li>";
                    _count++;
                }
            });


            if( 0<_count && _count<5 ){
                var _size=10*1;
                var _harf_size=_size/2;
                _str+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#428bca;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
            }else if( 5<=_count && _count<10 ){
                var _size=10*1.5;
                var _harf_size=_size/2;
                _str+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#42b5ca;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
            }else if( 10<=_count && _count<15 ){
                var _size=10*2;
                var _harf_size=_size/2;
                _str+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#ca42c2;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
            }else if( 15<=_count && _count<20 ){
                var _size=10*2.5;
                var _harf_size=_size/2;
                _str+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#4252ca;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
            }else if( 20<=_count && _count<25 ){
                var _size=10*3;
                var _harf_size=_size/2;
                _str+="<a style='position: absolute;left:50%;top:50%;margin-left:-"+_harf_size+"px;margin-top:-"+_harf_size+"px;background:#ca425f;width:"+_size+"px;height:"+_size+"px;display:block;border-radius:50%;'></a>";
            }

            $('td.'+location+' .tags_box').html(_str);


            return false;
          });


          //监听提交 添加抽检记录
          form.on('submit(demo1_add_cjjl)', function(data){
            
            var _json=_ajax_add_cjjl(data);

            if(_json.code==0){
                $("div[aria-describedby='dialog-confirm_add'] .ui-dialog-titlebar-close").trigger("click");
                // $("#grid-table-2").addRowData("1", _json.data, "first");  
            }

            if(_json.code==1){
                $("div[aria-describedby='dialog-confirm_add'] .ui-dialog-titlebar-close").trigger("click");
            }

            return false;
          });


          //监听提交 修改抽检记录
          form.on('submit(demo1_edit_2)', function(data){
            var _json=_ajax_edit_2(data);

            if(_json.code==0){
                var selectID=$("#grid-table-2").getGridParam("selrow");
                $("#grid-table-2").setRowData(selectID,{"CheckResult":_json.data});

                $("div[aria-describedby='dialog-confirm_edit_2'] .ui-dialog-titlebar-close").trigger("click");
            }

            if(_json.code==1){
                $("div[aria-describedby='dialog-confirm_edit_2'] .ui-dialog-titlebar-close").trigger("click");
            }

            return false;
          });


          //监听提交
          form.on('submit(demo1_error_edit)', function(data){
            var _json=_ajax_error_edit(data);

            console.log(_json);
return false;
            if(_json.code==0){
                $("div[aria-describedby='dialog-confirm_edit'] .ui-dialog-titlebar-close").trigger("click");
            }
            window.location.reload();
            return false;
          });


          //监听提交
          form.on('submit(demo1_search)', function(data){
            layer.alert(JSON.stringify(data.field), {
              title: '最终的提交信息'
            })
            return false;
          });
        });
    </script>
  </body>
</html>


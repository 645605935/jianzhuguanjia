<html>
 <head> 
  <meta http-equiv="x-ua-compatible" content="ie=7" /> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <title>新增资质案例</title> 
  <link type="text/css" rel="stylesheet" href="__PUBLIC__/Home/css/usercenter.css?v=20160601" /> 
  <link href="__PUBLIC__/Home/css/broker.css" rel="stylesheet" /> 
  <link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">
  <style>
     #CaseInfo_PicurePreview img {
         width: 100px;
         height: 100px;
     }
     .layui-upload-icon {
          margin: 6px 15px;
          line-height: 22px;
      }
  </style>

  <script src="__PUBLIC__/Admin/assets/js/jquery.min.js"></script> 
  <script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>
  <script src="__PUBLIC__/layer/layer.js"></script>
 </head> 
 <body> 

  <!-- 头部引用 -->
  <include file="Common/_header" />
  <!-- cr头部引用 -->
  <include file="Common/_cr_header" />
  
  <div class="elear" style="clear:both;"></div> 
  <div class="mion"> 
   <div class="mion_left"> 
        <!-- 左侧引用 -->
        <include file="Common/_left" />
   </div> 
   <link type="text/css" rel="stylesheet" href="__PUBLIC__/Home/css/caseinfo.css" /> 
    
   <div class="mion_right"> 
    <h4><span>实名认证</span></h4> 

        <!-- 表单开始 -->
        <form class="layui-form layui-form-pane col-xs-12" method="post" action="" id="edit_form" enctype="multipart/form-data">
                                                                      
            <table class="layui-table">
              <colgroup>
                  <col width="79%">
                  <col>
              </colgroup>
              <tbody>

                <tr>
                  <td>
                    <div class="layui-inline">
                      <div class="layui-form-item">
                        <label class="layui-form-label">公司名称</label>
                        <div class="layui-input-inline" style="width: 389px;">
                          <input type="text" name="company_name" lay-verify="required" value="{$companyinfo.company_name}" class="layui-input company_name">
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    
                  </td>
                </tr>

                <tr>
                  <td>
                    <div class="layui-inline">
                      <div class="layui-form-item">
                        <label class="layui-form-label">公司地址</label>
                        <div class="layui-input-inline">
                          <select name="province" class="province" lay-filter="province">
                            <option value="">--省/市--</option>
                            <foreach name="province" item="v">
                                <option value="{$v['provinceid']}" <if condition="$v['provinceid'] eq $companyinfo['company_province']">selected="selected"</if>>{$v['first_name']} {$v['province']}</option>
                            </foreach>
                          </select>
                        </div>
                        <div class="layui-input-inline">
                          <select name="city" class="city" lay-filter="city">
                            <option value="">--市/地区--</option>
                            <foreach name="city" item="v">
                                <option value="{$v['cityid']}" <if condition="$v['cityid'] eq $companyinfo['company_city']">selected="selected"</if>>{$v['first_name']} {$v['city']}</option>
                            </foreach>
                          </select>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    
                  </td>
                </tr>

                <tr>
                  <td>
                    <div class="layui-inline">
                      <div class="layui-form-item">
                        <label class="layui-form-label">详细地址</label>
                        <div class="layui-input-inline">
                          <input type="text" name="company_address" lay-verify="required" value="{$companyinfo.company_address}" autocomplete="off" class="layui-input company_address">
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    
                  </td>
                </tr>

                <tr>
                  <td>
                    <div class="layui-inline">
                      <div class="layui-form-item">
                        <label class="layui-form-label">公司规模</label>
                        <div class="layui-input-inline">
                          <select name="company_size" class="company_size">
                            <option value="">请选择</option>
                            <foreach name="comanySize" item="v">
                                <option value="{$v.id}" <if condition="$v['id'] eq $companyinfo['company_size']">selected</if>>{$v.title}</option>
                            </foreach>
                          </select>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    
                  </td>
                </tr>

                <tr>
                  <td>
                    <div class="layui-inline">
                      <div class="layui-form-item">
                        <label class="layui-form-label">营业执照</label>
                        <div class="layui-input-inline">
                          <input type="file" id="edit_upload_img" name="file" class="layui-upload-file">
                        </div>
                        <label class="">说明：图片不能大于2M的jpg、png图片，且清晰</label>
                      </div>
                    </div>
                  </td>
                  <td>
                    <if condition="$companyinfo.company_yingyezhizhao">
                        <img class="show_img" data-src="holder.js/100x100" class="img-thumbnail" alt="100x100" src="{$companyinfo.company_yingyezhizhao}" data-holder-rendered="true" style="width: 100px; height: 100px;">
                    <else/>
                        <img class="show_img" data-src="holder.js/100x100" class="img-thumbnail" alt="100x100" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgdmlld0JveD0iMCAwIDE0MCAxNDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjwhLS0KU291cmNlIFVSTDogaG9sZGVyLmpzLzE0MHgxNDAKQ3JlYXRlZCB3aXRoIEhvbGRlci5qcyAyLjYuMC4KTGVhcm4gbW9yZSBhdCBodHRwOi8vaG9sZGVyanMuY29tCihjKSAyMDEyLTIwMTUgSXZhbiBNYWxvcGluc2t5IC0gaHR0cDovL2ltc2t5LmNvCi0tPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbI2hvbGRlcl8xNWQ1MzI3ODU3YiB0ZXh0IHsgZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQgfSBdXT48L3N0eWxlPjwvZGVmcz48ZyBpZD0iaG9sZGVyXzE1ZDUzMjc4NTdiIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjQ1IiB5PSI3NC44Ij4xNDB4MTQwPC90ZXh0PjwvZz48L2c+PC9zdmc+" data-holder-rendered="true" style="width: 100px; height: 100px;">
                    </if>
                  </td>
                </tr>
             
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="2" style="text-align:center;">
                    <input type="hidden" name="company_yingyezhizhao" lay-verify="required" value="{$companyinfo.company_yingyezhizhao}" class="layui-input company_yingyezhizhao">
                    <button class="layui-btn" lay-submit="" lay-filter="demo1_edit">确认</button>
                    <button type="reset" class="layui-btn layui-btn-primary reset">重置</button>
                  </td>
                </tr>
              </tfoot>
            </table>

         </form>
        <!-- 表单结束 -->


   </div> 
   <div class="elear" style="clear:both;"></div> 
  </div> 
  <div class="elear" style="clear:both;"></div> 

  <!-- 底部引用 -->
  <include file="Common/_footer" />
  
 </body>
</html>


<script type="text/javascript">
    $(function(){
        init_editer();
    });
</script>

<script>
    //添加
    function _ajax_edit(_data){
         $.ajax({  
             async:false,
             type:'post',  
             contentType:"application/x-www-form-urlencoded",
             url : "{:U('Home/Company/ajax_save_companylicense')}",
             data: _data,
             dataType : 'json',
             success  : function(json) {
                 if(json.code==0){
                     alert(json.msg);
                 }else{
                     alert(json.msg);
                 }
             },
             error  : function() {  
                 alert('error');
             }  
         }); 
    }


    function init_editer(){
        layui.use(['form', 'layedit', 'laydate', 'upload'], function(){
          var form = layui.form()
          ,layer = layui.layer
          ,layedit = layui.layedit
          ,laydate = layui.laydate;

          var form_type='edit';

          //上传文件
          layui.upload({
             url: "{:U('Home/Index/lay_upload_file')}" //上传接口
             ,elem: '#'+form_type+'_upload_img' //指定原始元素，默认直接查找class="layui-upload-file"
             ,success: function(res){ //上传成功后的回调

               if(res.code==0){
                  $('#'+form_type+'_form .company_yingyezhizhao').val(res.data.src);
                  $('#'+form_type+'_form .show_img').attr('src', res.data.src);
               }
             }
          });

          
          //上传图片接口：注意：layedit.set 一定要放在 build前面，否则配置全局接口将无效
          layedit.set({
              uploadImage: {
                  url: "{:U('Home/Index/lay_upload_file')}", //接口url
                  type: 'post', //默认post
              }
          });

          //自定义验证规则
          form.verify({
            title: function(value){
              if(value.length < 5){
                return '标题至少得5个字符啊';
              }
            }
            ,pass: [/(.+){6,12}$/, '密码必须6到12位']
          });

          //监听提交
          form.on('submit(demo1_edit)', function(data){
            var _json=_ajax_edit(data.field);

            // alert(JSON.stringify(data.field));
            return false;
          });

          form.on('select(province)', function(data){
              var provinceid=data.value;
              if(provinceid){
                  _ajax_get_city_select(provinceid);
              }else{
                  alert('请选择省份');
              }

              return false;
          });


          
        });
    }

    function _ajax_get_city_select(provinceid){
        $.ajax({  
            async:false,
            type:'get',  
            contentType:"application/x-www-form-urlencoded",
            url : "{:U('Home/Index/ajax_get_city_list')}",
            data:{
              provinceid:provinceid
            },
            dataType : 'json',
            success  : function(json) {  
                if(json.code==0){
                    var data=json.data;

                    var str="<option value=''>--市/地区--</option>";
                    $.each(json.data, function(key, value) {
                         str+="<option value='"+value.cityid+"'>"+value.first_name+" "+value.city+"</option>";
                    });
                    $('#edit_form .city').html(str);
                    layui.form().render();

                }else{
                    layer.msg(json.msg);
                }
            },
            error  : function(json) {  
                layer.msg(json.msg);
            }  
        });
    }   
</script>